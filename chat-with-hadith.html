<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes">
    <meta name="theme-color" content="#0a5f4f">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© - Ø§Ø³Ø£Ù„ Ø§Ù„Ø¥Ø³Ù„Ø§Ù… AI</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans+Arabic:wght@100;200;300;400;500;600;700&family=Amiri+Quran&display=swap" rel="stylesheet">
    <style>
        * { 
            margin: 0; 
            padding: 0; 
            box-sizing: border-box; 
        }
        
        :root { 
            --primary: #0a5f4f; 
            --secondary: #2d8b74; 
            --gold: #d4a574; 
            --dark: #1a1a1a; 
            --light: #f5f5f5; 
            --quran-color: #ffd700;
            --sidebar-width: 320px;
        }
        
        body { 
            font-family: "IBM Plex Sans Arabic", sans-serif; 
            background: linear-gradient(135deg, #0a5f4f 0%, #1a4a3d 50%, #2d8b74 100%); 
            color: #fff; 
            overflow: hidden; 
            position: relative; 
            height: 100vh; 
            margin: 0;
        }
        
        .glass { 
            background: rgba(255, 255, 255, 0.08); 
            backdrop-filter: blur(20px); 
            border: 1px solid rgba(255, 255, 255, 0.15); 
            border-radius: 24px; 
        }
        
        .container { 
            display: flex; 
            height: 100vh; 
            padding: 20px; 
            gap: 20px; 
            position: relative; 
            z-index: 1; 
        }
        
        /* Sidebar Styles */
        .sidebar { 
            width: var(--sidebar-width);
            display: flex; 
            flex-direction: column; 
            padding: 1.5rem; 
            transition: transform 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .sidebar.collapsed {
            transform: translateX(calc(var(--sidebar-width) + 20px));
        }
        
        .sidebar-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 2rem;
        }
        
        .sidebar-title {
            color: var(--gold);
            font-family: 'Amiri Quran';
            font-size: 1.3rem;
        }
        
        .toggle-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 12px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
            font-size: 1.2rem;
        }
        
        .toggle-btn:hover {
            background: rgba(255, 255, 255, 0.15);
            transform: scale(1.05);
        }
        
        .new-chat-btn {
            background: var(--gold);
            color: var(--dark);
            border: none;
            border-radius: 12px;
            padding: 0.9rem;
            cursor: pointer;
            font-weight: bold;
            font-size: 1rem;
            transition: all 0.3s ease;
            margin-bottom: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }
        
        .new-chat-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212, 165, 116, 0.4);
        }
        
        .chats-container {
            flex: 1;
            overflow-y: auto;
            padding-right: 0.5rem;
        }
        
        .chats-container::-webkit-scrollbar {
            width: 6px;
        }
        
        .chats-container::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
        }
        
        .chats-container::-webkit-scrollbar-thumb {
            background: rgba(212, 165, 116, 0.5);
            border-radius: 10px;
        }
        
        .chat-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 0.8rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }
        
        .chat-item:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: var(--gold);
            transform: translateX(-5px);
        }
        
        .chat-item.active {
            background: rgba(212, 165, 116, 0.2);
            border-color: var(--gold);
        }
        
        .chat-title {
            font-size: 0.95rem;
            margin-bottom: 0.3rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .chat-time {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.6);
        }
        
        .delete-chat-btn {
            position: absolute;
            top: 50%;
            left: 10px;
            transform: translateY(-50%);
            background: rgba(255, 0, 0, 0.3);
            border: none;
            color: white;
            width: 30px;
            height: 30px;
            border-radius: 8px;
            cursor: pointer;
            opacity: 0;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .chat-item:hover .delete-chat-btn {
            opacity: 1;
        }
        
        .delete-chat-btn:hover {
            background: rgba(255, 0, 0, 0.6);
        }
        
        /* Floating Toggle Button (when sidebar is collapsed) */
        .floating-toggle {
            position: fixed;
            top: 30px;
            right: 30px;
            background: var(--gold);
            color: var(--dark);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            box-shadow: 0 5px 20px rgba(212, 165, 116, 0.4);
            transition: all 0.3s ease;
            z-index: 1000;
        }
        
        .floating-toggle.show {
            display: flex;
        }
        
        .floating-toggle:hover {
            transform: scale(1.1);
        }
        
        /* Main Chat Area */
        .chat-section { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            padding: 2rem; 
            min-width: 0;
            justify-content: center;
        }
        
        .chat-section.has-messages {
            justify-content: flex-start;
        }
        
        .chat-header { 
            text-align: center; 
            margin-bottom: 2rem; 
        }
        
        .chat-header h1 { 
            font-family: 'Amiri Quran'; 
            font-size: 1.6rem; 
            color: var(--gold); 
            margin-bottom: 0.3rem; 
        }
        
        .chat-header p { 
            color: rgba(255, 255, 255, 0.7); 
            font-size: 0.9rem; 
        }
        
        .chat-section.has-messages .chat-header {
            display: none;
        }
        
        /* Top Bar - ÙŠØ¸Ù‡Ø± Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© */
        .top-bar {
            display: none;
            align-items: center;
            justify-content: center;
            padding: 1rem 2rem;
            background: rgba(255, 255, 255, 0.05);
            border-bottom: 2px solid var(--gold);
            margin: -2rem -2rem 1.5rem -2rem;
            position: relative;
            overflow: hidden;
        }
        
        .chat-section.has-messages .top-bar {
            display: flex;
        }
        
        .top-bar::before,
        .top-bar::after {
            content: 'â—†';
            font-size: 1.2rem;
            color: var(--gold);
            opacity: 0.6;
            margin: 0 1rem;
        }
        
        .top-bar-title {
            font-family: 'Amiri Quran';
            font-size: 1.4rem;
            color: var(--gold);
            font-weight: 600;
            letter-spacing: 1px;
            display: flex;
            align-items: center;
            gap: 0.8rem;
        }
        
        .islamic-pattern {
            width: 24px;
            height: 24px;
            opacity: 0.8;
        }
        
        #chatArea { 
            flex: 1; 
            overflow-y: auto; 
            padding: 1.5rem; 
            margin-bottom: 1.5rem; 
            scroll-behavior: smooth;
            min-height: 0;
        }
        
        #chatArea:empty {
            display: none;
        }
        
        #chatArea::-webkit-scrollbar { 
            width: 10px; 
        }
        
        #chatArea::-webkit-scrollbar-track { 
            background: rgba(255, 255, 255, 0.05); 
            border-radius: 10px; 
        }
        
        #chatArea::-webkit-scrollbar-thumb { 
            background: rgba(212, 165, 116, 0.3); 
            border-radius: 10px; 
        }
        
        .message { 
            margin-bottom: 1.5rem; 
            animation: slideIn 0.4s cubic-bezier(0.23, 1, 0.32, 1); 
        }
        
        @keyframes slideIn { 
            from { 
                opacity: 0; 
                transform: translateY(20px); 
            } 
            to { 
                opacity: 1; 
                transform: translateY(0); 
            } 
        }
        
        .user-message { 
            text-align: left; 
        }
        
        .assistant-message { 
            text-align: right; 
        }
        
        .message-content { 
            display: inline-block; 
            max-width: 80%; 
            padding: 1rem 1.2rem; 
            border-radius: 20px; 
            line-height: 1.5; 
            position: relative; 
            overflow-wrap: break-word; 
            word-wrap: break-word; 
            word-break: break-word;
        }
        
        .user-message .message-content { 
            background: rgba(212, 165, 116, 0.2); 
            border: 1px solid rgba(212, 165, 116, 0.3); 
            border-bottom-right-radius: 5px; 
        }
        
        .assistant-message .message-content { 
            background: rgba(255, 255, 255, 0.1); 
            border: 1px solid rgba(255, 255, 255, 0.15); 
            border-bottom-left-radius: 5px; 
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø®Ø§Øµ Ù„Ù„Ø¢ÙŠØ§Øª Ø§Ù„ÙØ±Ø¯ÙŠØ© */
        .single-ayah-container {
            text-align: center;
            padding: 2rem;
            margin: 1.5rem 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            border: 2px solid rgba(212, 165, 116, 0.3);
            position: relative;
        }
        
        .single-ayah-text {
            font-family: 'Amiri Quran', serif;
            font-size: 1.8rem;
            line-height: 2.2;
            color: #fff;
            text-shadow: 0 0 10px rgba(255, 215, 0, 0.3);
            margin-bottom: 1.5rem;
            padding: 1rem;
        }
        
        .single-ayah-info {
            font-size: 1.1rem;
            color: var(--gold);
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
        }
        
        .single-ayah-verified {
            font-size: 1rem;
            color: #4CAF50;
            font-weight: bold;
            background: rgba(76, 175, 80, 0.1);
            padding: 0.5rem 1rem;
            border-radius: 20px;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 1rem;
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø®Ø§Øµ Ù„Ù„Ø³ÙˆØ± Ø§Ù„ÙƒØ§Ù…Ù„Ø© */
        .complete-surah-container {
            text-align: center;
            padding: 2rem;
            margin: 1.5rem 0;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            border: 3px solid rgba(212, 165, 116, 0.5);
            position: relative;
        }
        
        .surah-header {
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid rgba(212, 165, 116, 0.3);
        }
        
        .surah-title {
            font-family: 'Amiri Quran', serif;
            font-size: 2rem;
            color: var(--gold);
            margin-bottom: 0.5rem;
        }
        
        .surah-info {
            font-size: 1.1rem;
            color: rgba(255, 255, 255, 0.8);
            display: flex;
            justify-content: center;
            gap: 2rem;
            margin-bottom: 1rem;
        }
        
        .ayahs-container {
            max-height: 400px;
            overflow-y: auto;
            padding: 1rem;
            margin: 1rem 0;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .ayah-item {
            margin-bottom: 1.5rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 10px;
            border-right: 3px solid rgba(212, 165, 116, 0.3);
            transition: all 0.3s ease;
        }
        
        .ayah-item:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateX(-5px);
        }
        
        .ayah-text {
            font-family: 'Amiri Quran', serif;
            font-size: 1.4rem;
            line-height: 1.8;
            color: #fff;
            text-align: right;
            margin-bottom: 0.5rem;
        }
        
        .ayah-number {
            color: var(--gold);
            font-size: 0.9rem;
            text-align: left;
            font-weight: bold;
            background: rgba(212, 165, 116, 0.1);
            padding: 0.3rem 0.8rem;
            border-radius: 20px;
            display: inline-block;
        }
        
        .surah-footer {
            margin-top: 2rem;
            padding-top: 1rem;
            border-top: 2px solid rgba(212, 165, 116, 0.3);
        }
        
        /* ØªÙ†Ø³ÙŠÙ‚ Ø¹Ø§Ù… Ù„Ù„Ù‚Ø±Ø¢Ù† */
        .quran-verse { 
            color: var(--quran-color); 
            font-family: 'Amiri Quran'; 
            font-size: 1.4rem; 
            line-height: 1.8; 
            text-shadow: 0 0 5px rgba(255, 215, 0, 0.2);
            position: relative;
        }
        
        .source-info {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.7);
            margin-top: 0.8rem;
            padding-top: 0.8rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .verification-badge {
            display: inline-block;
            background: rgba(76, 175, 80, 0.2);
            color: #4CAF50;
            padding: 0.3rem 0.8rem;
            border-radius: 15px;
            font-size: 0.85rem;
            margin-right: 0.5rem;
            border: 1px solid rgba(76, 175, 80, 0.3);
        }
        
        .show-surah-btn {
            background: rgba(212, 165, 116, 0.2);
            color: var(--gold);
            border: 1px solid rgba(212, 165, 116, 0.3);
            border-radius: 12px;
            padding: 0.8rem 1.5rem;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.3s ease;
            margin-top: 1rem;
            display: inline-block;
            text-decoration: none;
        }
        
        .show-surah-btn:hover {
            background: rgba(212, 165, 116, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(212, 165, 116, 0.3);
        }
        
        .similar-questions {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .similar-questions-title {
            font-size: 0.9rem;
            color: rgba(255, 255, 255, 0.6);
            margin-bottom: 0.5rem;
        }
        
        .q-chip {
            display: inline-block;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 20px;
            padding: 0.5rem 1rem;
            margin: 0.3rem;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }
        
        .q-chip:hover {
            background: rgba(212, 165, 116, 0.2);
            border-color: var(--gold);
            transform: translateY(-2px);
        }
        
        /* Input Area */
        .input-area { 
            position: relative; 
        }
        
        .input-wrapper { 
            display: flex; 
            background: rgba(255, 255, 255, 0.05); 
            border: 2px solid rgba(212, 165, 116, 0.3); 
            border-radius: 16px; 
            overflow: hidden; 
            transition: all 0.3s ease; 
            align-items: center; 
        }
        
        .input-wrapper:focus-within { 
            border-color: var(--gold); 
            box-shadow: 0 0 20px rgba(212, 165, 116, 0.2); 
            transform: translateY(-2px); 
        }
        
        #userInput { 
            flex: 1; 
            background: transparent; 
            border: none; 
            padding: 1.2rem 1.5rem; 
            color: white; 
            font-family: "IBM Plex Sans Arabic"; 
            font-size: 1rem; 
            resize: none; 
            outline: none; 
            max-height: 150px; 
            min-height: 56px; 
        }
        
        #userInput::placeholder { 
            color: rgba(255, 255, 255, 0.5); 
        }
        
        .send-btn { 
            background: var(--gold); 
            color: var(--dark); 
            border: none; 
            border-radius: 12px; 
            width: 56px; 
            height: 56px; 
            margin: 6px; 
            cursor: pointer; 
            transition: all 0.3s ease; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
            font-size: 1.2rem; 
        }
        
        .send-btn:hover:not(:disabled) { 
            background: #e6b469; 
            transform: scale(1.05); 
        }
        
        .send-btn:disabled { 
            opacity: 0.5; 
            cursor: not-allowed; 
        }
        
        .input-info { 
            text-align: center; 
            font-size: 0.8rem; 
            color: rgba(255, 255, 255, 0.5); 
            margin-top: 0.5rem; 
        }
        
        /* Responsive Design */
        @media (max-width: 1024px) {
            .container {
                padding: 15px;
                gap: 15px;
            }
            
            .sidebar {
                position: fixed;
                z-index: 100;
                height: calc(100vh - 30px);
                transform: translateX(0);
            }
            
            .sidebar.collapsed {
                transform: translateX(calc(var(--sidebar-width) + 30px));
            }
            
            .ayahs-container {
                max-height: 300px;
            }
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            .chat-section {
                padding: 1rem;
            }
            
            .message-content {
                max-width: 90%;
                font-size: 0.95rem;
            }
            
            .single-ayah-text {
                font-size: 1.4rem;
                line-height: 1.8;
            }
            
            .surah-title {
                font-size: 1.6rem;
            }
            
            .ayah-text {
                font-size: 1.2rem;
            }
            
            .ayahs-container {
                max-height: 250px;
            }
        }
        
        /* Loading Animation */
        .loader {
            display: inline-block;
            width: 60px;
            height: 60px;
            position: relative;
        }
        
        .loader:before, .loader:after {
            content: '';
            border-radius: 50%;
            position: absolute;
            inset: 0;
            box-shadow: 0 0 10px 2px rgba(212, 165, 116, 0.3) inset;
        }
        
        .loader:after {
            box-shadow: 0 2px 0 var(--gold) inset;
            animation: rotate 1s linear infinite;
        }
        
        @keyframes rotate {
            0% { transform: rotate(0); }
            100% { transform: rotate(360deg); }
        }
        
        /* Quran Icon */
        .quran-icon {
            display: inline-block;
            margin-left: 0.5rem;
            color: var(--gold);
            font-size: 1.2rem;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Sidebar -->
        <aside class="sidebar glass">
            <div class="sidebar-header">
                <div class="sidebar-title">ğŸ“– Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª</div>
                <button class="toggle-btn" id="toggleSidebar">â˜°</button>
            </div>
            
            <button class="new-chat-btn" onclick="createNewChat()">
                <span>+</span> Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©
            </button>
            
            <div class="chats-container" id="chatsList">
                <!-- Ø³ÙŠØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ù‡Ù†Ø§ -->
            </div>
        </aside>

        <!-- Main Chat Area -->
        <main class="chat-section glass" id="chatSection">
            <div class="chat-header">
                <h1>Ø§Ø³Ø£Ù„ Ø§Ù„Ø¥Ø³Ù„Ø§Ù… AI</h1>
                <p>Ø§Ø³Ø£Ù„ Ø¹Ù† Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…ØŒ Ø§Ù„Ø­Ø¯ÙŠØ« Ø§Ù„Ø´Ø±ÙŠÙØŒ Ø§Ù„ÙÙ‚Ù‡ ÙˆØ£Ø­ÙƒØ§Ù… Ø§Ù„Ø´Ø±ÙŠØ¹Ø© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©</p>
            </div>
            
            <div class="top-bar">
                <div class="top-bar-title">
                    <svg class="islamic-pattern" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2L9.18 9.18L2 12L9.18 14.82L12 22L14.82 14.82L22 12L14.82 9.18L12 2Z"/>
                    </svg>
                    Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
                    <svg class="islamic-pattern" viewBox="0 0 24 24" fill="currentColor">
                        <path d="M12 2L9.18 9.18L2 12L9.18 14.82L12 22L14.82 14.82L22 12L14.82 9.18L12 2Z"/>
                    </svg>
                </div>
            </div>
            
            <div id="chatArea">
                <!-- Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø© Ù‡Ù†Ø§ -->
            </div>
            
            <div class="input-area">
                <div class="input-wrapper">
                    <textarea 
                        id="userInput" 
                        placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§... (Ù…Ø«Ø§Ù„: Ø§ÙƒØªØ¨ Ù„ÙŠ Ø³ÙˆØ±Ø© Ø§Ù„ÙØ§ØªØ­Ø© ÙƒØ§Ù…Ù„Ø© Ø£Ùˆ Ø§Ø¹Ø±Ø¶ Ø§Ù„Ø¢ÙŠØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù…Ù† Ø³ÙˆØ±Ø© Ø§Ù„Ø¨Ù‚Ø±Ø©)" 
                        rows="1"
                        oninput="autoResize(this)"
                        onkeypress="handleEnter(event)"
                    ></textarea>
                    <button class="send-btn" onclick="sendMessage()" id="sendBtn">
                        ğŸ“¨
                    </button>
                </div>
                <div class="input-info">
                    Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ Enter Ù„Ù„Ø¥Ø±Ø³Ø§Ù„ Ø£Ùˆ Shift+Enter Ù„Ù„Ø³Ø·Ø± Ø§Ù„Ø¬Ø¯ÙŠØ¯
                </div>
            </div>
        </main>
        
        <!-- Floating Toggle Button for Mobile -->
        <button class="floating-toggle" id="floatingToggle">â˜°</button>
    </div>

    <script>
        // Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        let chats = [];
        let currentChatId = null;
        let quranData = null;
        
        // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        document.addEventListener('DOMContentLoaded', function() {
            loadChats();
            loadQuranData();
            setupEventListeners();
            showWelcomeMessage();
            
            // ØªØ­Ø¯ÙŠØ« Ø­Ø¬Ù… Ø§Ù„Ù†Ø§ÙØ°Ø©
            window.addEventListener('resize', handleResize);
            handleResize();
        });
        
        // ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…
        async function loadQuranData() {
            try {
                const response = await fetch('https://cdn.jsdelivr.net/npm/quran-json@3.1.2/quran.json');
                quranData = await response.json();
                console.log('âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…');
            } catch (error) {
                console.error('âŒ ÙØ´Ù„ ÙÙŠ ØªØ­Ù…ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø±Ø¢Ù†:', error);
                quranData = [];
            }
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª Ù…Ù† localStorage
        function loadChats() {
            const savedChats = localStorage.getItem('islamicChats');
            if (savedChats) {
                chats = JSON.parse(savedChats);
                renderChatsList();
                
                if (chats.length > 0) {
                    loadChat(chats[chats.length - 1].id);
                }
            } else {
                createNewChat();
            }
        }
        
        // Ø­ÙØ¸ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª ÙÙŠ localStorage
        function saveChatsToStorage() {
            localStorage.setItem('islamicChats', JSON.stringify(chats));
        }
        
        // Ø¹Ø±Ø¶ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø§Øª
        function renderChatsList() {
            const chatsList = document.getElementById('chatsList');
            chatsList.innerHTML = '';
            
            [...chats].reverse().forEach(chat => {
                const chatItem = document.createElement('div');
                chatItem.className = `chat-item ${currentChatId === chat.id ? 'active' : ''}`;
                chatItem.onclick = () => loadChat(chat.id);
                
                const time = new Date(chat.createdAt).toLocaleString('ar-SA', {
                    day: 'numeric',
                    month: 'short',
                    hour: '2-digit',
                    minute: '2-digit'
                });
                
                chatItem.innerHTML = `
                    <div class="chat-title">${chat.title || 'Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©'}</div>
                    <div class="chat-time">${time}</div>
                    <button class="delete-chat-btn" onclick="deleteChat('${chat.id}', event)">ğŸ—‘</button>
                `;
                
                chatsList.appendChild(chatItem);
            });
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©
        function createNewChat() {
            const chatId = Date.now().toString();
            const newChat = {
                id: chatId,
                title: 'Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©',
                messages: [],
                createdAt: new Date().toISOString()
            };
            
            chats.push(newChat);
            saveChatsToStorage();
            renderChatsList();
            loadChat(chatId);
            
            showWelcomeMessage();
        }
        
        // ØªØ­Ù…ÙŠÙ„ Ù…Ø­Ø§Ø¯Ø«Ø©
        function loadChat(chatId) {
            currentChatId = chatId;
            const chat = chats.find(c => c.id === chatId);
            
            if (chat) {
                renderChat(chat);
                renderChatsList();
                updateChatTitle(chat);
            }
        }
        
        // Ø¹Ø±Ø¶ Ù…Ø­Ø§Ø¯Ø«Ø©
        function renderChat(chat) {
            const chatArea = document.getElementById('chatArea');
            chatArea.innerHTML = '';
            
            if (chat.messages.length === 0) {
                showWelcomeMessage();
                return;
            }
            
            chat.messages.forEach(msg => {
                addMessageToUI(msg.content, msg.role, msg.source, msg.questions || [], false, msg.isSingleAyah, msg.isCompleteSurah);
            });
            
            const chatSection = document.querySelector('.chat-section');
            chatSection.classList.add('has-messages');
        }
        
        // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨ÙŠØ©
        function showWelcomeMessage() {
            const chatArea = document.getElementById('chatArea');
            chatArea.innerHTML = '';
            
            const welcomeMessage = `
                <div style="text-align: center; padding: 2rem;">
                    <h1 style="font-family: 'Amiri Quran'; font-size: 2rem; color: var(--gold); margin-bottom: 1rem;">
                        Ø¨Ø³Ù… Ø§Ù„Ù„Ù‡ Ø§Ù„Ø±Ø­Ù…Ù† Ø§Ù„Ø±Ø­ÙŠÙ…
                    </h1>
                    <p style="font-size: 1.1rem; margin-bottom: 2rem; color: rgba(255, 255, 255, 0.9);">
                        Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø¥Ø³Ù„Ø§Ù… AI
                    </p>
                    <div style="display: flex; flex-direction: column; gap: 1rem; max-width: 400px; margin: 0 auto;">
                        <div class="q-chip" onclick="askQuestion('Ø§ÙƒØªØ¨ Ù„ÙŠ Ø³ÙˆØ±Ø© Ø§Ù„ÙØ§ØªØ­Ø© ÙƒØ§Ù…Ù„Ø©')">
                            Ø§ÙƒØªØ¨ Ù„ÙŠ Ø³ÙˆØ±Ø© Ø§Ù„ÙØ§ØªØ­Ø© ÙƒØ§Ù…Ù„Ø©
                        </div>
                        <div class="q-chip" onclick="askQuestion('Ø§Ø¹Ø±Ø¶ Ø§Ù„Ø¢ÙŠØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù…Ù† Ø³ÙˆØ±Ø© Ø§Ù„Ø¨Ù‚Ø±Ø©')">
                            Ø§Ø¹Ø±Ø¶ Ø§Ù„Ø¢ÙŠØ© Ø§Ù„Ø£ÙˆÙ„Ù‰ Ù…Ù† Ø³ÙˆØ±Ø© Ø§Ù„Ø¨Ù‚Ø±Ø©
                        </div>
                        <div class="q-chip" onclick="askQuestion('Ù…Ø§ Ù‡ÙŠ Ø£Ø±ÙƒØ§Ù† Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ØŸ')">
                            Ù…Ø§ Ù‡ÙŠ Ø£Ø±ÙƒØ§Ù† Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ØŸ
                        </div>
                        <div class="q-chip" onclick="askQuestion('Ø£Ø¹Ø·Ù†ÙŠ Ø¢ÙŠØ© Ø§Ù„ÙƒØ±Ø³ÙŠ')">
                            Ø£Ø¹Ø·Ù†ÙŠ Ø¢ÙŠØ© Ø§Ù„ÙƒØ±Ø³ÙŠ
                        </div>
                    </div>
                </div>
            `;
            
            chatArea.innerHTML = welcomeMessage;
            
            const chatSection = document.querySelector('.chat-section');
            chatSection.classList.remove('has-messages');
        }
        
        // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©
        function updateChatTitle(chat) {
            if (chat.messages.length >= 2) {
                const firstUserMessage = chat.messages.find(m => m.role === 'user');
                if (firstUserMessage) {
                    const shortMessage = firstUserMessage.content.substring(0, 30);
                    if (shortMessage !== chat.title) {
                        chat.title = shortMessage + (firstUserMessage.content.length > 30 ? '...' : '');
                        saveChatsToStorage();
                        renderChatsList();
                    }
                }
            }
        }
        
        // Ø­Ø°Ù Ù…Ø­Ø§Ø¯Ø«Ø©
        function deleteChat(chatId, event) {
            event.stopPropagation();
            
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„Ù…Ø­Ø§Ø¯Ø«Ø©ØŸ')) {
                chats = chats.filter(c => c.id !== chatId);
                
                if (currentChatId === chatId) {
                    if (chats.length > 0) {
                        loadChat(chats[chats.length - 1].id);
                    } else {
                        createNewChat();
                    }
                }
                
                saveChatsToStorage();
                renderChatsList();
            }
        }
        
        // Ø¥Ø¹Ø¯Ø§Ø¯ Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
        function setupEventListeners() {
            const toggleBtn = document.getElementById('toggleSidebar');
            const floatingToggle = document.getElementById('floatingToggle');
            
            if (toggleBtn) {
                toggleBtn.addEventListener('click', toggleSidebar);
            }
            
            if (floatingToggle) {
                floatingToggle.addEventListener('click', toggleSidebar);
            }
        }
        
        // ØªØ¨Ø¯ÙŠÙ„ Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ
        function toggleSidebar() {
            const sidebar = document.querySelector('.sidebar');
            const floatingToggle = document.getElementById('floatingToggle');
            
            sidebar.classList.toggle('collapsed');
            floatingToggle.classList.toggle('show');
        }
        
        // Ø¥Ø¹Ø§Ø¯Ø© Ø­Ø¬Ù… Ø§Ù„Ù†Ø§ÙØ°Ø©
        function handleResize() {
            const isMobile = window.innerWidth <= 768;
            const sidebar = document.querySelector('.sidebar');
            const floatingToggle = document.getElementById('floatingToggle');
            
            if (isMobile) {
                sidebar.classList.add('collapsed');
                floatingToggle.classList.add('show');
            } else {
                sidebar.classList.remove('collapsed');
                floatingToggle.classList.remove('show');
            }
        }
        
        // Ø¶Ø¨Ø· Ø§Ù„Ø§Ø±ØªÙØ§Ø¹ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ Ù„Ù„Ù†Øµ
        function autoResize(textarea) {
            textarea.style.height = 'auto';
            textarea.style.height = Math.min(textarea.scrollHeight, 150) + 'px';
        }
        
        // Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø¶ØºØ· Enter
        function handleEnter(event) {
            if (event.key === 'Enter' && !event.shiftKey) {
                event.preventDefault();
                sendMessage();
            }
        }
        
        // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø±Ø³Ø§Ù„Ø©
        function sendMessage() {
            const userInput = document.getElementById('userInput');
            const message = userInput.value.trim();
            
            if (!message) return;
            
            const sendBtn = document.getElementById('sendBtn');
            sendBtn.disabled = true;
            
            addMessageToUI(message, 'user');
            
            processQuery(message);
            
            userInput.value = '';
            userInput.style.height = 'auto';
            sendBtn.disabled = false;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ÙƒÙ„Ù…Ø§Øª Ø£Ù…Ø±
        function hasCommandWord(message) {
            const commandWords = [
                'Ø§ÙƒØªØ¨', 'Ø§ÙƒØªØ¨ Ù„ÙŠ', 'Ø§ÙƒØªØ¨Ù„ÙŠ', 'Ø§ÙƒØªØ¨ Ù„Ù‰', 'Ø§ÙƒØªØ¨Ù„ÙŠ',
                'Ø§Ø¹Ø±Ø¶', 'Ø§Ø¹Ø±Ø¶ Ù„ÙŠ', 'Ø§Ø¹Ø±Ø¶Ù„ÙŠ', 'Ø§Ø¹Ø±Ø¶ Ù„Ù‰', 'Ø§Ø¹Ø±Ø¶Ù„ÙŠ',
                'Ø£Ø¹Ø·Ù†ÙŠ', 'Ø£Ø¹Ø·ÙŠÙ†ÙŠ', 'Ø§Ø¹Ø·Ù†ÙŠ', 'Ø§Ø¹Ø·ÙŠÙ†ÙŠ', 'Ø§Ø¹Ø·Ù†ÙŠ',
                'Ø§Ø±ÙŠØ¯', 'Ø£Ø±ÙŠØ¯', 'Ø§Ø¨ÙŠ', 'Ø§Ø¨Ù‰', 'Ø§Ø¨ÙŠ', 'Ø§Ø¨ØºÙ‰', 'Ø£Ø¨ØºÙ‰',
                'Ø§Ù‚Ø±Ø£', 'Ø§Ù‚Ø±Ø§', 'Ø£Ù‚Ø±Ø£', 'Ø£Ù‚Ø±Ø§', 'Ù‚Ø±Ø§Ø¡Ø©', 'Ù‚Ø±Ø§Ø¡Ù‡',
                'Ù†Ø±ÙŠØ¯', 'Ø¹Ø§ÙŠØ²', 'Ø¹Ø§ÙˆØ²', 'Ø¹ÙˆØ²', 'Ø£Ø­Ø¨', 'Ø§Ø­Ø¨',
                'Ù…Ø§ Ù‡ÙŠ', 'Ù…Ø§ Ù‡Ùˆ', 'Ù…Ø§Ù‡ÙŠ', 'Ù…Ø§Ù‡Ùˆ', 'Ù…Ø§ Ù…Ø¹Ù†Ù‰', 'Ù…Ø§Ø°Ø§',
                'ÙˆØ§Ø­Ø¯', 'ÙˆØ­Ø¯Ù‡', 'ÙˆØ§Ø­Ø¯Ø©', 'Ø§ÙˆÙ„', 'Ø£ÙˆÙ„', 'Ø§Ø®Ø±', 'Ø¢Ø®Ø±'
            ];
            
            return commandWords.some(command => message.includes(command));
        }
        
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø³ÙˆØ±
        function getSurahNames() {
            if (!quranData) return [];
            return quranData.map(surah => {
                const name = surah.name.toLowerCase();
                // Ø¥Ø±Ø¬Ø§Ø¹ Ø§Ù„Ø§Ø³Ù… Ø¨Ø¯ÙˆÙ† ÙƒÙ„Ù…Ø© "Ø³ÙˆØ±Ø©"
                return name.replace('Ø³ÙˆØ±Ø©', '').trim();
            });
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…
        async function processQuery(message) {
            try {
                console.log(`ğŸ” Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…: "${message}"`);
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø·Ù„Ø¨ Ø³ÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø© Ø£ÙˆÙ„Ø§Ù‹
                if (isCompleteSurahRequest(message)) {
                    console.log('ğŸ“– ØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø·Ù„Ø¨ Ø³ÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø©');
                    
                    const surahResult = findCompleteSurah(message);
                    
                    if (surahResult) {
                        console.log(`âœ… Ø¹Ø±Ø¶ Ø³ÙˆØ±Ø© ${surahResult.name} ÙƒØ§Ù…Ù„Ø©`);
                        displayCompleteSurah(surahResult);
                        return;
                    } else {
                        console.log('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙˆØ±Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©');
                        addMessageToUI('Ø¹Ø°Ø±Ø§Ù‹ØŒ Ù„Ù… Ø£ØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙˆØ±Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ÙƒØªØ§Ø¨Ø© Ø§Ø³Ù… Ø§Ù„Ø³ÙˆØ±Ø© Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­.', 'assistant', null, [], true);
                        return;
                    }
                }
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„Ø£Ø®Ø±Ù‰
                if (isQuranQuestion(message)) {
                    console.log('ğŸ” ØªÙ… Ø§Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ø³Ø¤Ø§Ù„ Ù‚Ø±Ø¢Ù†ÙŠ');
                    
                    const quranResults = searchQuran(message);
                    
                    if (quranResults && quranResults.length > 0) {
                        addMessageToUI(message, 'user', null, [], true);
                        
                        const isSingleAyahReq = isSingleAyahRequest(message) || 
                                               (quranResults.length === 1 && 
                                                quranResults[0].type === 'ayah' &&
                                                !isCompleteSurahRequest(message));
                        
                        let response = '';
                        quranResults.forEach(result => {
                            if (result.type === 'surah') {
                                response += `ğŸ“– **Ø³ÙˆØ±Ø© ${result.name}**\n`;
                                response += `Ø±Ù‚Ù… Ø§Ù„Ø³ÙˆØ±Ø©: ${result.number}\n`;
                                response += `Ø¹Ø¯Ø¯ Ø§Ù„Ø¢ÙŠØ§Øª: ${result.numberOfAyahs}\n`;
                                response += `âœ“ ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØµØ¯Ø± Ø§Ù„Ù…Ø¹ØªÙ…Ø¯\n\n`;
                                response += `<button class="show-surah-btn" onclick="showCompleteSurah(${result.number})">ğŸ“– Ø¹Ø±Ø¶ Ø³ÙˆØ±Ø© ${result.name} ÙƒØ§Ù…Ù„Ø©</button>\n\n`;
                            } else if (result.type === 'ayah' && result.verified) {
                                if (isSingleAyahReq) {
                                    response += `<div class="single-ayah-container">
                                        <div class="single-ayah-text">${result.text}</div>
                                        <div class="single-ayah-info">ğŸ“ ${result.surahName} - Ø¢ÙŠØ© ${result.ayahNumber}</div>
                                        <div class="single-ayah-verified">âœ“ ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØµØ¯Ø± Ø§Ù„Ù…Ø¹ØªÙ…Ø¯</div>
                                    </div>`;
                                } else {
                                    response += `<div class="quran-verse">${result.text}</div>\n\n`;
                                    response += `<div class="source-info">`;
                                    response += `<div>ğŸ“ ${result.surahName} - Ø¢ÙŠØ© ${result.ayahNumber}</div>`;
                                    response += `<span class="verification-badge">âœ“ ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚</span>`;
                                    response += `</div>\n\n`;
                                    response += `<button class="show-surah-btn" onclick="showCompleteSurah(${result.surahNumber})">ğŸ“– Ø¹Ø±Ø¶ Ø³ÙˆØ±Ø© ${result.surahName} ÙƒØ§Ù…Ù„Ø©</button>\n\n`;
                                }
                            }
                        });
                        
                        if (response) {
                            addMessageToUI(response, 'assistant', null, [], true, isSingleAyahReq, false);
                        } else {
                            addMessageToUI('Ù„Ù… Ø£ØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ù‡Ø°Ù‡ Ø§Ù„Ø¢ÙŠØ© ÙÙŠ Ø§Ù„Ù…ØµØ¯Ø± Ø§Ù„Ù…Ø­Ø¯Ø¯. ÙŠØ±Ø¬Ù‰ Ø¥Ø¹Ø§Ø¯Ø© ØµÙŠØ§ØºØ© Ø§Ù„Ø³Ø¤Ø§Ù„.', 'assistant', null, [], true);
                        }
                        
                        return;
                    }
                }
                
                // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ø³Ø¤Ø§Ù„Ø§Ù‹ Ù‚Ø±Ø¢Ù†ÙŠØ§Ù‹ØŒ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø£Ø®Ø±Ù‰
                console.log('ğŸ“š Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ø£Ø®Ø±Ù‰');
                const similarQuestions = getSimilarQuestions(message);
                const sources = getSourcesByTopic(message);
                
                const response = generateResponse(message, sources);
                addMessageToUI(response, 'assistant', sources.length > 0 ? 'Ù…ØµØ§Ø¯Ø± Ù…ØªØ¹Ø¯Ø¯Ø© Ù…ÙØ­ÙÙ‚Ù‚ÙØ©' : null, similarQuestions, true);
                
            } catch (error) {
                console.error('âŒ Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø§Ø³ØªØ¹Ù„Ø§Ù…:', error);
                addMessageToUI('Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø³Ø¤Ø§Ù„Ùƒ. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.', 'assistant', null, [], true);
            }
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø³Ø¤Ø§Ù„ Ø§Ù„Ù‚Ø±Ø¢Ù†
        function isQuranQuestion(message) {
            const lowerMessage = message.toLowerCase();
            
            // Ù‚Ø§Ø¦Ù…Ø© Ù…ÙˆØ³Ø¹Ø© Ø¨Ø¬Ù…ÙŠØ¹ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© Ø§Ù„Ù…ØªØ¹Ù„Ù‚Ø© Ø¨Ø§Ù„Ù‚Ø±Ø¢Ù†
            const quranKeywords = [
                // ÙƒÙ„Ù…Ø§Øª Ø¹Ø§Ù…Ø© Ø¹Ù† Ø§Ù„Ù‚Ø±Ø¢Ù†
                'Ù‚Ø±Ø¢Ù†', 'Ù‚Ø±Ø§Ù†', 'Ù‚Ø±Ø£Ù†', 'Ù‚Ø±Ø§Ù†ÙŠ', 'Ù‚Ø±Ø¢Ù†ÙŠØ©', 'Ù‚Ø±Ø§Ù†ÙŠÙ‡',
                'Ø§Ù„Ù‚Ø±Ø¢Ù†', 'Ø§Ù„Ù‚Ø±Ø§Ù†', 'Ø§Ù„Ù‚Ø±Ø£Ù†',
                
                // Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ø·Ù„Ø¨Ø§Øª
                'Ø¢ÙŠØ©', 'Ø§ÙŠØ©', 'Ø§Ù„Ø¢ÙŠØ©', 'Ø§Ù„Ø§ÙŠØ©', 'Ø³ÙˆØ±Ø©', 'Ø³ÙˆØ±Ù‡', 'Ø§Ù„Ø³ÙˆØ±Ø©', 'Ø§Ù„Ø³ÙˆØ±Ù‡',
                'Ø¢ÙŠØ§Øª', 'Ø§ÙŠØ§Øª', 'Ø§Ù„Ø¢ÙŠØ§Øª', 'Ø§Ù„Ø§ÙŠØ§Øª', 'Ø³ÙˆØ±', 'Ø³ÙˆØ±', 'Ø§Ù„Ø³ÙˆØ±',
                
                // ØµÙŠØº Ø§Ù„Ø£ÙˆØ§Ù…Ø±
                'Ø§Ù‚Ø±Ø£', 'Ø§Ù‚Ø±Ø§', 'Ø£Ù‚Ø±Ø£', 'Ø£Ù‚Ø±Ø§', 'Ø§Ù„Ù‚Ø±Ø§Ø¡Ø©', 'Ø§Ù„Ù‚Ø±Ø§Ø¡Ù‡',
                'Ø§ÙƒØªØ¨', 'Ø§ÙƒØªØ¨ Ù„ÙŠ', 'Ø§ÙƒØªØ¨Ù„ÙŠ', 'Ø§ÙƒØªØ¨ Ù„Ù‰', 'Ø§ÙƒØªØ¨Ù„ÙŠ',
                'Ø§Ø¹Ø±Ø¶', 'Ø§Ø¹Ø±Ø¶ Ù„ÙŠ', 'Ø§Ø¹Ø±Ø¶Ù„ÙŠ', 'Ø§Ø¹Ø±Ø¶ Ù„Ù‰', 'Ø§Ø¹Ø±Ø¶Ù„ÙŠ',
                'Ø£Ø¹Ø·Ù†ÙŠ', 'Ø£Ø¹Ø·ÙŠÙ†ÙŠ', 'Ø§Ø¹Ø·Ù†ÙŠ', 'Ø§Ø¹Ø·ÙŠÙ†ÙŠ', 'Ø§Ø¹Ø·Ù†ÙŠ',
                'Ø§Ø±ÙŠØ¯', 'Ø£Ø±ÙŠØ¯', 'Ø§Ø¨ÙŠ', 'Ø§Ø¨Ù‰', 'Ø§Ø¨ØºÙ‰', 'Ø£Ø¨ØºÙ‰',
                'Ù†Ø±ÙŠØ¯', 'Ø¹Ø§ÙŠØ²', 'Ø¹Ø§ÙˆØ²', 'Ø¹ÙˆØ²', 'Ø£Ø­Ø¨', 'Ø§Ø­Ø¨',
                'Ù…Ø§ Ù‡ÙŠ', 'Ù…Ø§ Ù‡Ùˆ', 'Ù…Ø§Ù‡ÙŠ', 'Ù…Ø§Ù‡Ùˆ', 'Ù…Ø§ Ù…Ø¹Ù†Ù‰', 'Ù…Ø§Ø°Ø§',
                'Ø§Ø¨ØºÙ‰', 'Ø£Ø¨ØºÙ‰', 'Ø¨ØºÙŠØª', 'Ø§Ø¨ØºÙŠ', 'Ø£Ø¨ØºÙŠ',
                'ÙˆØ§Ø­Ø¯', 'ÙˆØ­Ø¯Ù‡', 'ÙˆØ§Ø­Ø¯Ø©',
                
                // Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø³ÙˆØ± Ø§Ù„Ù…Ø´Ù‡ÙˆØ±Ø©
                'Ø§Ù„ÙØ§ØªØ­Ø©', 'Ø§Ù„Ø¨Ù‚Ø±Ø©', 'Ø§Ù„ Ø¹Ù…Ø±Ø§Ù†', 'Ø§Ù„ Ø¹Ù…Ø±Ø§Ù†', 'Ø§Ù„Ù†Ø³Ø§Ø¡', 'Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©',
                'Ø§Ù„Ø§Ù†Ø¹Ø§Ù…', 'Ø§Ù„Ø§Ø¹Ø±Ø§Ù', 'Ø§Ù„Ø£Ù†ÙØ§Ù„', 'Ø§Ù„ØªÙˆØ¨Ø©', 'ÙŠÙˆÙ†Ø³', 'Ù‡ÙˆØ¯',
                'ÙŠÙˆØ³Ù', 'Ø§Ù„Ø±Ø¹Ø¯', 'Ø§Ø¨Ø±Ø§Ù‡ÙŠÙ…', 'Ø§Ù„Ø­Ø¬Ø±', 'Ø§Ù„Ù†Ø­Ù„', 'Ø§Ù„Ø§Ø³Ø±Ø§Ø¡',
                'Ø§Ù„ÙƒÙ‡Ù', 'Ù…Ø±ÙŠÙ…', 'Ø·Ù‡', 'Ø§Ù„Ø§Ù†Ø¨ÙŠØ§Ø¡', 'Ø§Ù„Ø­Ø¬', 'Ø§Ù„Ù…Ø¤Ù…Ù†ÙˆÙ†',
                'Ø§Ù„Ù†ÙˆØ±', 'Ø§Ù„ÙØ±Ù‚Ø§Ù†', 'Ø§Ù„Ø´Ø¹Ø±Ø§Ø¡', 'Ø§Ù„Ù†Ù…Ù„', 'Ø§Ù„Ù‚ØµØµ', 'Ø§Ù„Ø¹Ù†ÙƒØ¨ÙˆØª',
                'Ø§Ù„Ø±ÙˆÙ…', 'Ù„Ù‚Ù…Ø§Ù†', 'Ø§Ù„Ø³Ø¬Ø¯Ø©', 'Ø§Ù„Ø§Ø­Ø²Ø§Ø¨', 'Ø³Ø¨Ø£', 'ÙØ§Ø·Ø±',
                'ÙŠØ³', 'Ø§Ù„ØµØ§ÙØ§Øª', 'Øµ', 'Ø§Ù„Ø²Ù…Ø±', 'ØºØ§ÙØ±', 'ÙØµÙ„Øª',
                'Ø§Ù„Ø´ÙˆØ±Ù‰', 'Ø§Ù„Ø²Ø®Ø±Ù', 'Ø§Ù„Ø¯Ø®Ø§Ù†', 'Ø§Ù„Ø¬Ø§Ø«ÙŠØ©', 'Ø§Ù„Ø§Ø­Ù‚Ø§Ù', 'Ù…Ø­Ù…Ø¯',
                'Ø§Ù„ÙØªØ­', 'Ø§Ù„Ø­Ø¬Ø±Ø§Øª', 'Ù‚', 'Ø§Ù„Ø°Ø§Ø±ÙŠØ§Øª', 'Ø§Ù„Ø·ÙˆØ±', 'Ø§Ù„Ù†Ø¬Ù…',
                'Ø§Ù„Ù‚Ù…Ø±', 'Ø§Ù„Ø±Ø­Ù…Ù†', 'Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©', 'Ø§Ù„Ø­Ø¯ÙŠØ¯', 'Ø§Ù„Ù…Ø¬Ø§Ø¯Ù„Ø©', 'Ø§Ù„Ø­Ø´Ø±',
                'Ø§Ù„Ù…Ù…ØªØ­Ù†Ø©', 'Ø§Ù„ØµÙ', 'Ø§Ù„Ø¬Ù…Ø¹Ø©', 'Ø§Ù„Ù…Ù†Ø§ÙÙ‚ÙˆÙ†', 'Ø§Ù„ØªØºØ§Ø¨Ù†', 'Ø§Ù„Ø·Ù„Ø§Ù‚',
                'Ø§Ù„ØªØ­Ø±ÙŠÙ…', 'Ø§Ù„Ù…Ù„Ùƒ', 'Ø§Ù„Ù‚Ù„Ù…', 'Ø§Ù„Ø­Ø§Ù‚Ø©', 'Ø§Ù„Ù…Ø¹Ø§Ø±Ø¬', 'Ù†ÙˆØ­',
                'Ø§Ù„Ø¬Ù†', 'Ø§Ù„Ù…Ø²Ù…Ù„', 'Ø§Ù„Ù…Ø¯Ø«Ø±', 'Ø§Ù„Ù‚ÙŠØ§Ù…Ø©', 'Ø§Ù„Ø§Ù†Ø³Ø§Ù†', 'Ø§Ù„Ù…Ø±Ø³Ù„Ø§Øª',
                'Ø§Ù„Ù†Ø¨Ø£', 'Ø§Ù„Ù†Ø§Ø²Ø¹Ø§Øª', 'Ø¹Ø¨Ø³', 'Ø§Ù„ØªÙƒÙˆÙŠØ±', 'Ø§Ù„Ø§Ù†ÙØ·Ø§Ø±', 'Ø§Ù„Ù…Ø·ÙÙÙŠÙ†',
                'Ø§Ù„Ø§Ù†Ø´Ù‚Ø§Ù‚', 'Ø§Ù„Ø¨Ø±ÙˆØ¬', 'Ø§Ù„Ø·Ø§Ø±Ù‚', 'Ø§Ù„Ø§Ø¹Ù„Ù‰', 'Ø§Ù„ØºØ§Ø´ÙŠØ©', 'Ø§Ù„ÙØ¬Ø±',
                'Ø§Ù„Ø¨Ù„Ø¯', 'Ø§Ù„Ø´Ù…Ø³', 'Ø§Ù„Ù„ÙŠÙ„', 'Ø§Ù„Ø¶Ø­Ù‰', 'Ø§Ù„Ø´Ø±Ø­', 'Ø§Ù„ØªÙŠÙ†',
                'Ø§Ù„Ø¹Ù„Ù‚', 'Ø§Ù„Ù‚Ø¯Ø±', 'Ø§Ù„Ø¨ÙŠÙ†Ø©', 'Ø§Ù„Ø²Ù„Ø²Ù„Ø©', 'Ø§Ù„Ø¹Ø§Ø¯ÙŠØ§Øª', 'Ø§Ù„Ù‚Ø§Ø±Ø¹Ø©',
                'Ø§Ù„ØªÙƒØ§Ø«Ø±', 'Ø§Ù„Ø¹ØµØ±', 'Ø§Ù„Ù‡Ù…Ø²Ø©', 'Ø§Ù„ÙÙŠÙ„', 'Ù‚Ø±ÙŠØ´', 'Ø§Ù„Ù…Ø§Ø¹ÙˆÙ†',
                'Ø§Ù„ÙƒÙˆØ«Ø±', 'Ø§Ù„ÙƒØ§ÙØ±ÙˆÙ†', 'Ø§Ù„Ù†ØµØ±', 'Ø§Ù„Ù…Ø³Ø¯', 'Ø§Ù„Ø§Ø®Ù„Ø§Øµ', 'Ø§Ù„ÙÙ„Ù‚',
                'Ø§Ù„Ù†Ø§Ø³'
            ];
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ø§Ù„Ø±Ø³Ø§Ù„Ø© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£ÙŠ Ù…Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©
            return quranKeywords.some(keyword => lowerMessage.includes(keyword));
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø·Ù„Ø¨ Ø³ÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø©
        function isCompleteSurahRequest(message) {
            const lowerMessage = message.toLowerCase().trim();
            
            // Ù‚Ø§Ø¦Ù…Ø© Ù…ÙˆØ³Ø¹Ø© Ø¨Ø¬Ù…ÙŠØ¹ ØµÙŠØº Ø·Ù„Ø¨ Ø§Ù„Ø³ÙˆØ± Ø§Ù„ÙƒØ§Ù…Ù„Ø©
            const surahIndicators = [
                // Ø§Ù„ØµÙŠØº Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
                'Ø³ÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø©',
                'Ø³ÙˆØ±Ù‡ ÙƒØ§Ù…Ù„Ù‡',
                'Ø³ÙˆØ±Ø© ÙƒØ§Ù…Ù„Ù‡',
                'Ø³ÙˆØ±Ù‡ ÙƒØ§Ù…Ù„Ø©',
                
                // ØµÙŠØº "ÙƒÙ„"
                'ÙƒÙ„ Ø§Ù„Ø³ÙˆØ±Ø©',
                'ÙƒÙ„ Ø³ÙˆØ±Ø©',
                'Ø§Ù„Ø³ÙˆØ±Ø© ÙƒÙ„Ù‡Ø§',
                'Ø³ÙˆØ±Ø© ÙƒÙ„Ù‡Ø§',
                'Ø§Ù„Ø³ÙˆØ±Ø© ÙƒØ§Ù…Ù„Ù‡Ø§',
                'Ø³ÙˆØ±Ø© ÙƒØ§Ù…Ù„Ù‡Ø§',
                'Ø§Ù„Ø³ÙˆØ±Ø© Ø¨ÙƒØ§Ù…Ù„Ù‡Ø§',
                'Ø³ÙˆØ±Ø© Ø¨ÙƒØ§Ù…Ù„Ù‡Ø§',
                'Ø§Ù„Ø³ÙˆØ±Ø© Ø¬Ù…ÙŠØ¹Ù‡Ø§',
                'Ø³ÙˆØ±Ø© Ø¬Ù…ÙŠØ¹Ù‡Ø§',
                'ÙƒØ§Ù…Ù„ Ø§Ù„Ø³ÙˆØ±Ø©',
                'ÙƒØ§Ù…Ù„Ù‡ Ø§Ù„Ø³ÙˆØ±Ø©',
                
                // ØµÙŠØº Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ù…Ø¹ "Ø³ÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø©"
                'Ø§Ù‚Ø±Ø£ Ø³ÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø©',
                'Ø§ÙƒØªØ¨ Ø³ÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø©',
                'Ø§Ø¹Ø±Ø¶ Ø³ÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø©',
                'Ø£Ø¹Ø·Ù†ÙŠ Ø³ÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø©',
                'Ø§Ø±ÙŠØ¯ Ø³ÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø©',
                'Ø§Ø¨ÙŠ Ø³ÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø©',
                'Ø§Ø¨ØºÙ‰ Ø³ÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø©',
                'Ù†Ø±ÙŠØ¯ Ø³ÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø©',
                
                // ØµÙŠØº Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ù…Ø¹ Ø§Ø³Ù… Ø§Ù„Ø³ÙˆØ±Ø© Ùˆ"ÙƒØ§Ù…Ù„Ø©"
                'ÙƒØ§Ù…Ù„Ø©',
                'ÙƒØ§Ù…Ù„Ù‡',
                'ÙƒÙ„Ù‡Ø§',
                'Ø¨ÙƒØ§Ù…Ù„Ù‡Ø§',
                'Ø¬Ù…ÙŠØ¹Ù‡Ø§',
                
                // Ø§Ù„ØµÙŠØº Ø§Ù„Ø£Ø®Ø±Ù‰
                'Ø¹Ø±Ø¶ Ø§Ù„Ø³ÙˆØ±Ø©',
                'Ø¹Ø±Ø¶ Ø³ÙˆØ±Ø©',
                'Ø§Ù„Ø³ÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø©',
                'Ø³ÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø©'
            ];
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø£ÙŠ Ù…Ù† Ø§Ù„Ù…Ø¤Ø´Ø±Ø§Øª
            const hasSurahIndicator = surahIndicators.some(indicator => lowerMessage.includes(indicator));
            
            // Ø£ÙŠØ¶Ø§ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†Ù…Ø·: [Ø£Ù…Ø±] + [Ø³ÙˆØ±Ø©] + [Ø§Ø³Ù… Ø³ÙˆØ±Ø©] + [ÙƒØ§Ù…Ù„Ø©]
            const hasCommand = hasCommandWord(lowerMessage);
            const hasSurahKeyword = lowerMessage.includes('Ø³ÙˆØ±Ø©') || lowerMessage.includes('Ø³ÙˆØ±Ù‡');
            const hasCompleteWord = lowerMessage.includes('ÙƒØ§Ù…Ù„Ø©') || lowerMessage.includes('ÙƒØ§Ù…Ù„Ù‡') || 
                                   lowerMessage.includes('ÙƒÙ„Ù‡Ø§') || lowerMessage.includes('Ø¨ÙƒØ§Ù…Ù„Ù‡Ø§');
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø£Ù…Ø± + Ø³ÙˆØ±Ø© + ÙƒØ§Ù…Ù„Ø©
            if ((hasCommand || hasSurahKeyword) && hasCompleteWord) {
                return true;
            }
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø§Ø³Ù… Ø³ÙˆØ±Ø© + ÙƒØ§Ù…Ù„Ø©
            const surahNames = getSurahNames();
            const hasSurahName = surahNames.some(name => lowerMessage.includes(name));
            if (hasSurahName && hasCompleteWord) {
                return true;
            }
            
            return hasSurahIndicator;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø·Ù„Ø¨ Ø¢ÙŠØ© ÙØ±Ø¯ÙŠØ©
        function isSingleAyahRequest(message) {
            const lowerMessage = message.toLowerCase().trim();
            
            // Ù‚Ø§Ø¦Ù…Ø© Ù…ÙˆØ³Ø¹Ø© Ø¨Ø¬Ù…ÙŠØ¹ ØµÙŠØº Ø·Ù„Ø¨ Ø§Ù„Ø¢ÙŠØ§Øª Ø§Ù„ÙØ±Ø¯ÙŠØ©
            const singleAyahIndicators = [
                // ØµÙŠØº Ø§Ù„Ø¢ÙŠØ© Ø§Ù„ÙØ±Ø¯ÙŠØ©
                'Ø¢ÙŠØ©',
                'Ø§ÙŠØ©',
                'Ø§Ù„Ø¢ÙŠØ©',
                'Ø§Ù„Ø§ÙŠØ©',
                'Ø¢ÙŠØ© ÙˆØ§Ø­Ø¯Ø©',
                'Ø§ÙŠØ© ÙˆØ§Ø­Ø¯Ø©',
                'Ø¢ÙŠØ© ÙˆØ­Ø¯Ø©',
                'Ø§ÙŠØ© ÙˆØ­Ø¯Ø©',
                'Ø¢ÙŠØ© ÙˆØ­Ø¯Ù‡',
                'Ø§ÙŠØ© ÙˆØ­Ø¯Ù‡',
                
                // ØµÙŠØº Ø§Ù„Ø£ÙˆØ§Ù…Ø± Ù…Ø¹ Ø§Ù„Ø¢ÙŠØ©
                'Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø¢ÙŠØ©',
                'Ù…Ø§ Ù‡ÙŠ Ø§Ù„Ø§ÙŠØ©',
                'Ù…Ø§Ù‡ÙŠ Ø§Ù„Ø¢ÙŠØ©',
                'Ù…Ø§Ù‡ÙŠ Ø§Ù„Ø§ÙŠØ©',
                'Ù…Ø§ Ù…Ø¹Ù†Ù‰ Ø§Ù„Ø¢ÙŠØ©',
                'Ù…Ø§ Ù…Ø¹Ù†Ù‰ Ø§Ù„Ø§ÙŠØ©',
                
                // ØµÙŠØº Ø§Ù„Ø¢ÙŠØ© Ø¨Ø±Ù‚Ù…
                'Ø¢ÙŠØ© Ø±Ù‚Ù…',
                'Ø§ÙŠØ© Ø±Ù‚Ù…',
                'Ø§Ù„Ø¢ÙŠØ© Ø±Ù‚Ù…',
                'Ø§Ù„Ø§ÙŠØ© Ø±Ù‚Ù…',
                
                // ØµÙŠØº Ø§Ù„Ù‚Ø±Ø§Ø¡Ø© Ù„Ù„Ø¢ÙŠØ©
                'Ø§Ù‚Ø±Ø£ Ù„ÙŠ Ø§Ù„Ø¢ÙŠØ©',
                'Ø§Ù‚Ø±Ø£ Ù„ÙŠ Ø§Ù„Ø§ÙŠØ©',
                'Ø§ÙƒØªØ¨ Ù„ÙŠ Ø§Ù„Ø¢ÙŠØ©',
                'Ø§ÙƒØªØ¨ Ù„ÙŠ Ø§Ù„Ø§ÙŠØ©',
                'Ø§Ø¹Ø±Ø¶ Ù„ÙŠ Ø§Ù„Ø¢ÙŠØ©',
                'Ø§Ø¹Ø±Ø¶ Ù„ÙŠ Ø§Ù„Ø§ÙŠØ©',
                
                // ØµÙŠØº Ù…Ø­Ø¯Ø¯Ø©
                'Ø§Ù„Ø¢ÙŠØ© Ø§Ù„Ø£ÙˆÙ„Ù‰',
                'Ø§Ù„Ø¢ÙŠØ© Ø§Ù„Ø§Ø®ÙŠØ±Ø©',
                'Ø§Ù„Ø¢ÙŠØ© Ø§Ù„Ø£Ø®ÙŠØ±Ø©',
                'Ø¢ÙŠØ© Ø£ÙˆÙ„Ù‰',
                'Ø§ÙŠØ© Ø§ÙˆÙ„Ù‰',
                'Ø¢ÙŠØ© Ø£Ø®ÙŠØ±Ø©',
                'Ø§ÙŠØ© Ø§Ø®ÙŠØ±Ø©',
                
                // ØµÙŠØº Ø§Ù„Ø³ÙˆØ±Ø© ÙˆØ§Ù„Ø¢ÙŠØ©
                'Ù…Ù† Ø³ÙˆØ±Ø©',
                'ÙÙŠ Ø³ÙˆØ±Ø©',
                'Ø³ÙˆØ±Ø© ÙˆØ¢ÙŠØ©',
                'Ø³ÙˆØ±Ø© ÙˆØ§ÙŠØ©'
            ];
            
            // Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„ØªÙŠ ØªØ´ÙŠØ± Ø¥Ù„Ù‰ Ø·Ù„Ø¨ Ø³ÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø© (Ù†Ø³ØªØ«Ù†ÙŠÙ‡Ø§)
            const surahIndicators = [
                'Ø³ÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø©',
                'Ø³ÙˆØ±Ù‡ ÙƒØ§Ù…Ù„Ù‡',
                'ÙƒÙ„ Ø§Ù„Ø³ÙˆØ±Ø©',
                'Ø§Ù„Ø³ÙˆØ±Ø© ÙƒÙ„Ù‡Ø§',
                'Ø¹Ø±Ø¶ Ø§Ù„Ø³ÙˆØ±Ø©',
                'Ø³ÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø©',
                'Ø§Ù„Ø³ÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø©',
                'ÙƒØ§Ù…Ù„Ø©',
                'ÙƒØ§Ù…Ù„Ù‡',
                'ÙƒÙ„Ù‡Ø§',
                'Ø¨ÙƒØ§Ù…Ù„Ù‡Ø§',
                'Ø¬Ù…ÙŠØ¹Ù‡Ø§'
            ];
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø¢ÙŠØ© Ø§Ù„ÙØ±Ø¯ÙŠØ©
            const hasAyahIndicator = singleAyahIndicators.some(keyword => lowerMessage.includes(keyword));
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø¹Ø¯Ù… ÙˆØ¬ÙˆØ¯ Ù…Ø¤Ø´Ø±Ø§Øª Ø§Ù„Ø³ÙˆØ±Ø© Ø§Ù„ÙƒØ§Ù…Ù„Ø©
            const hasSurahIndicator = surahIndicators.some(keyword => lowerMessage.includes(keyword));
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†Ù…Ø·: [Ø£Ù…Ø±] + [Ø³ÙˆØ±Ø©] + [Ø¢ÙŠØ©]
            const hasCommand = hasCommandWord(lowerMessage);
            const hasSurahKeyword = lowerMessage.includes('Ø³ÙˆØ±Ø©') || lowerMessage.includes('Ø³ÙˆØ±Ù‡');
            const hasAyahKeyword = lowerMessage.includes('Ø¢ÙŠØ©') || lowerMessage.includes('Ø§ÙŠØ©');
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø£Ù…Ø± + Ø³ÙˆØ±Ø© + Ø¢ÙŠØ© (ÙˆÙ„ÙŠØ³ Ø·Ù„Ø¨ Ø³ÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø©)
            if ((hasCommand || hasSurahKeyword) && hasAyahKeyword && !hasSurahIndicator) {
                return true;
            }
            
            // Ø¥Ø°Ø§ ÙƒØ§Ù† Ù‡Ù†Ø§Ùƒ Ø§Ø³Ù… Ø³ÙˆØ±Ø© + Ø¢ÙŠØ©
            const surahNames = getSurahNames();
            const hasSurahName = surahNames.some(name => lowerMessage.includes(name));
            if (hasSurahName && hasAyahKeyword && !hasSurahIndicator) {
                return true;
            }
            
            return hasAyahIndicator && !hasSurahIndicator;
        }
        
        // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø³ÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø©
        function findCompleteSurah(message) {
            if (!quranData || quranData.length === 0) return null;
            
            const lowerMessage = message.toLowerCase().trim();
            
            // Ø¥Ø²Ø§Ù„Ø© ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ø£Ù…Ø± Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
            const commandWordsToRemove = [
                'Ø§ÙƒØªØ¨', 'Ø§ÙƒØªØ¨ Ù„ÙŠ', 'Ø§ÙƒØªØ¨Ù„ÙŠ', 'Ø§ÙƒØªØ¨ Ù„Ù‰',
                'Ø§Ø¹Ø±Ø¶', 'Ø§Ø¹Ø±Ø¶ Ù„ÙŠ', 'Ø§Ø¹Ø±Ø¶Ù„ÙŠ', 'Ø§Ø¹Ø±Ø¶ Ù„Ù‰',
                'Ø£Ø¹Ø·Ù†ÙŠ', 'Ø£Ø¹Ø·ÙŠÙ†ÙŠ', 'Ø§Ø¹Ø·Ù†ÙŠ', 'Ø§Ø¹Ø·ÙŠÙ†ÙŠ',
                'Ø§Ø±ÙŠØ¯', 'Ø£Ø±ÙŠØ¯', 'Ø§Ø¨ÙŠ', 'Ø§Ø¨Ù‰', 'Ø§Ø¨ØºÙ‰', 'Ø£Ø¨ØºÙ‰',
                'Ø§Ù‚Ø±Ø£', 'Ø§Ù‚Ø±Ø§', 'Ø£Ù‚Ø±Ø£', 'Ø£Ù‚Ø±Ø§',
                'Ù†Ø±ÙŠØ¯', 'Ø¹Ø§ÙŠØ²', 'Ø¹Ø§ÙˆØ²', 'Ø¹ÙˆØ²', 'Ø£Ø­Ø¨', 'Ø§Ø­Ø¨',
                'Ù…Ø§ Ù‡ÙŠ', 'Ù…Ø§ Ù‡Ùˆ', 'Ù…Ø§Ù‡ÙŠ', 'Ù…Ø§Ù‡Ùˆ',
                'ÙˆØ§Ø­Ø¯', 'ÙˆØ­Ø¯Ù‡', 'ÙˆØ§Ø­Ø¯Ø©'
            ];
            
            let cleanedMessage = lowerMessage;
            commandWordsToRemove.forEach(word => {
                cleanedMessage = cleanedMessage.replace(word, '');
            });
            
            // Ø¥Ø²Ø§Ù„Ø© ÙƒÙ„Ù…Ø§Øª "Ø³ÙˆØ±Ø©" Ùˆ"ÙƒØ§Ù…Ù„Ø©" ÙˆÙ…Ø§ Ø´Ø§Ø¨Ù‡
            cleanedMessage = cleanedMessage
                .replace(/Ø³ÙˆØ±Ø©|Ø³ÙˆØ±Ù‡|ÙƒØ§Ù…Ù„Ø©|ÙƒØ§Ù…Ù„Ù‡|ÙƒÙ„Ù‡Ø§|Ø¨ÙƒØ§Ù…Ù„Ù‡Ø§|Ø¬Ù…ÙŠØ¹Ù‡Ø§|ÙƒØ§Ù…Ù„|ÙƒØ§Ù…Ù„Ù‡/g, '')
                .trim();
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¨Ø±Ù‚Ù… Ø§Ù„Ø³ÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹
            const numberMatch = cleanedMessage.match(/\d+/);
            if (numberMatch) {
                const surahNumber = parseInt(numberMatch[0]);
                if (surahNumber >= 1 && surahNumber <= 114) {
                    const surah = quranData.find(s => s.id === surahNumber);
                    if (surah) {
                        console.log(`âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙˆØ±Ø© Ø¨Ø±Ù‚Ù…: ${surahNumber} (${surah.name})`);
                        return surah;
                    }
                }
            }
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø³ÙˆØ±Ø© ÙÙŠ Ø§Ù„Ù†Øµ Ø§Ù„Ù†Ø¸ÙŠÙ
            for (let surah of quranData) {
                const surahName = surah.name.toLowerCase();
                const cleanSurahName = surahName.replace('Ø³ÙˆØ±Ø©', '').trim();
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ø³Ù… Ø§Ù„Ø³ÙˆØ±Ø© Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§ ÙÙŠ Ø§Ù„Ù†Øµ Ø§Ù„Ù†Ø¸ÙŠÙ
                if (cleanedMessage.includes(cleanSurahName) || lowerMessage.includes(cleanSurahName)) {
                    console.log(`âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙˆØ±Ø© Ø¨Ø§Ù„Ø§Ø³Ù…: ${surah.name}`);
                    return surah;
                }
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ø¨Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø¨Ø¯ÙŠÙ„Ø© Ø£Ùˆ Ø§Ù„Ø£Ø¬Ø²Ø§Ø¡ Ù…Ù† Ø§Ù„Ø§Ø³Ù…
                const nameParts = cleanSurahName.split(' ');
                for (let part of nameParts) {
                    if (part.length > 2 && (cleanedMessage.includes(part) || lowerMessage.includes(part))) {
                        console.log(`âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙˆØ±Ø© Ø¨Ø¬Ø²Ø¡ Ø§Ù„Ø§Ø³Ù…: ${part} (${surah.name})`);
                        return surah;
                    }
                }
            }
            
            // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø£ØµÙ„ÙŠØ© Ø¨Ø¯ÙˆÙ† ØªÙ†Ø¸ÙŠÙ Ù„Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©
            for (let surah of quranData) {
                const surahName = surah.name.toLowerCase();
                if (lowerMessage.includes(surahName)) {
                    console.log(`âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙˆØ±Ø© Ø¨Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„: ${surah.name}`);
                    return surah;
                }
            }
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø³ÙˆØ± Ù…Ø´Ù‡ÙˆØ±Ø© Ù…Ø¹Ø±ÙˆÙØ©
            const popularSurahs = [
                { name: 'Ø§Ù„ÙØ§ØªØ­Ø©', number: 1 },
                { name: 'Ø§Ù„Ø¨Ù‚Ø±Ø©', number: 2 },
                { name: 'Ø§Ù„ Ø¹Ù…Ø±Ø§Ù†', number: 3 },
                { name: 'Ø§Ù„Ù†Ø³Ø§Ø¡', number: 4 },
                { name: 'Ø§Ù„Ù…Ø§Ø¦Ø¯Ø©', number: 5 },
                { name: 'Ø§Ù„Ø§Ù†Ø¹Ø§Ù…', number: 6 },
                { name: 'Ø§Ù„Ø§Ø¹Ø±Ø§Ù', number: 7 },
                { name: 'Ø§Ù„Ø§Ù†ÙØ§Ù„', number: 8 },
                { name: 'Ø§Ù„ØªÙˆØ¨Ø©', number: 9 },
                { name: 'ÙŠÙˆÙ†Ø³', number: 10 },
                { name: 'ÙŠÙˆØ³Ù', number: 12 },
                { name: 'Ø§Ù„ÙƒÙ‡Ù', number: 18 },
                { name: 'Ù…Ø±ÙŠÙ…', number: 19 },
                { name: 'Ø·Ù‡', number: 20 },
                { name: 'Ø§Ù„Ø±Ø­Ù…Ù†', number: 55 },
                { name: 'Ø§Ù„ÙˆØ§Ù‚Ø¹Ø©', number: 56 },
                { name: 'Ø§Ù„Ù…Ù„Ùƒ', number: 67 },
                { name: 'Ø§Ù„Ù†Ø¨Ø£', number: 78 }
            ];
            
            for (let popular of popularSurahs) {
                if (lowerMessage.includes(popular.name.toLowerCase())) {
                    const surah = quranData.find(s => s.id === popular.number);
                    if (surah) {
                        console.log(`âœ… ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙˆØ±Ø© Ø§Ù„Ù…Ø´Ù‡ÙˆØ±Ø©: ${surah.name}`);
                        return surah;
                    }
                }
            }
            
            console.log('âŒ Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø³ÙˆØ±Ø© ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ø·Ù„Ø¨:', message);
            return null;
        }
        
        // Ø§Ù„Ø¨Ø­Ø« ÙÙŠ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…
        function searchQuran(query) {
            if (!quranData || quranData.length === 0) {
                console.warn('âš ï¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø±Ø¢Ù† ØºÙŠØ± Ù…ØªÙˆÙØ±Ø©');
                return null;
            }
            
            const lowerQuery = query.toLowerCase().trim();
            const results = [];
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø·Ù„Ø¨ Ø¢ÙŠØ© Ù…Ø­Ø¯Ø¯Ø©
            const surahAyahMatch = extractSurahAndAyah(query);
            if (surahAyahMatch) {
                const { surahNumber, ayahNumber } = surahAyahMatch;
                const surah = quranData.find(s => s.id === surahNumber);
                if (surah && surah.ayas && surah.ayas[ayahNumber - 1]) {
                    results.push({
                        type: 'ayah',
                        text: surah.ayas[ayahNumber - 1].text,
                        surahNumber: surah.id,
                        surahName: surah.name,
                        ayahNumber: ayahNumber,
                        verified: true
                    });
                    return results;
                }
            }
            
            // Ø§Ù„Ø¨Ø­Ø« Ø§Ù„Ù†ØµÙŠ ÙÙŠ Ø§Ù„Ø¢ÙŠØ§Øª
            quranData.forEach(surah => {
                if (surah.ayas) {
                    surah.ayas.forEach((ayah, index) => {
                        const ayahText = ayah.text.toLowerCase();
                        if (ayahText.includes(lowerQuery) || 
                            containsArabicVariations(ayahText, lowerQuery)) {
                            results.push({
                                type: 'ayah',
                                text: ayah.text,
                                surahNumber: surah.id,
                                surahName: surah.name,
                                ayahNumber: index + 1,
                                verified: true
                            });
                        }
                    });
                }
            });
            
            // Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ù†ØªØ§Ø¦Ø¬ØŒ Ù†Ø­Ø§ÙˆÙ„ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø£Ø³Ù…Ø§Ø¡ Ø§Ù„Ø³ÙˆØ±
            if (results.length === 0) {
                const matchingSurah = quranData.find(surah => 
                    surah.name.toLowerCase().includes(lowerQuery) ||
                    containsArabicVariations(surah.name.toLowerCase(), lowerQuery)
                );
                
                if (matchingSurah) {
                    results.push({
                        type: 'surah',
                        number: matchingSurah.id,
                        name: matchingSurah.name,
                        numberOfAyahs: matchingSurah.ayas ? matchingSurah.ayas.length : 0,
                        verified: true
                    });
                }
            }
            
            // Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ø£ÙŠ Ù†ØªØ§Ø¦Ø¬ØŒ Ù†Ø­Ø§ÙˆÙ„ Ø§Ù„Ø¨Ø­Ø« Ø¨Ø¨Ø¹Ø¶ Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…Ø´Ù‡ÙˆØ±Ø©
            if (results.length === 0) {
                const commonWords = ['Ø§Ù„Ù„Ù‡', 'Ø§Ù„Ø±Ø­Ù…Ù†', 'Ø§Ù„Ø±Ø­ÙŠÙ…', 'Ø§Ù„ÙƒØªØ§Ø¨', 'Ø§Ù„Ù…Ø¤Ù…Ù†ÙŠÙ†', 'Ø§Ù„ØµÙ„Ø§Ø©', 'Ø§Ù„Ø²ÙƒØ§Ø©'];
                const foundWord = commonWords.find(word => lowerQuery.includes(word));
                
                if (foundWord) {
                    quranData.forEach(surah => {
                        if (surah.ayas) {
                            surah.ayas.forEach((ayah, index) => {
                                if (ayah.text.toLowerCase().includes(foundWord)) {
                                    results.push({
                                        type: 'ayah',
                                        text: ayah.text,
                                        surahNumber: surah.id,
                                        surahName: surah.name,
                                        ayahNumber: index + 1,
                                        verified: true
                                    });
                                }
                            });
                        }
                    });
                }
            }
            
            return results.slice(0, 5);
        }
        
        // Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø±Ù‚Ù… Ø§Ù„Ø³ÙˆØ±Ø© ÙˆØ§Ù„Ø¢ÙŠØ© Ù…Ù† Ø§Ù„Ù†Øµ
        function extractSurahAndAyah(text) {
            const pattern1 = /Ø³ÙˆØ±Ø©\s+(\S+)\s+Ø¢ÙŠØ©\s+(\d+)/;
            const pattern2 = /(\S+)\s+(\d+)/;
            
            let match = text.match(pattern1);
            if (match) {
                const surahName = match[1];
                const ayahNumber = parseInt(match[2]);
                const surahNumber = getSurahNumberByName(surahName);
                if (surahNumber && ayahNumber) {
                    return { surahNumber, ayahNumber };
                }
            }
            
            match = text.match(pattern2);
            if (match) {
                const surahName = match[1];
                const ayahNumber = parseInt(match[2]);
                const surahNumber = getSurahNumberByName(surahName);
                if (surahNumber && ayahNumber) {
                    return { surahNumber, ayahNumber };
                }
            }
            
            return null;
        }
        
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„Ø³ÙˆØ±Ø© Ù…Ù† Ø§Ø³Ù…Ù‡Ø§
        function getSurahNumberByName(surahName) {
            if (!quranData) return null;
            
            const arabicNumbers = {
                'ÙˆØ§Ø­Ø¯': 1, 'Ø§Ø«Ù†Ø§Ù†': 2, 'Ø«Ù„Ø§Ø«Ø©': 3, 'Ø£Ø±Ø¨Ø¹Ø©': 4, 'Ø®Ù…Ø³Ø©': 5,
                'Ø³ØªØ©': 6, 'Ø³Ø¨Ø¹Ø©': 7, 'Ø«Ù…Ø§Ù†ÙŠØ©': 8, 'ØªØ³Ø¹Ø©': 9, 'Ø¹Ø´Ø±Ø©': 10
            };
            
            if (arabicNumbers[surahName]) {
                return arabicNumbers[surahName];
            }
            
            const surah = quranData.find(s => 
                s.name.toLowerCase() === surahName.toLowerCase() ||
                s.name.replace('Ø³ÙˆØ±Ø©', '').trim().toLowerCase() === surahName.toLowerCase()
            );
            
            return surah ? surah.id : null;
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø§Ø®ØªÙ„Ø§ÙØ§Øª ÙÙŠ Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ
        function containsArabicVariations(text, query) {
            const variations = {
                'Ø§': ['Ø£', 'Ø¥', 'Ø¢'],
                'Ø£': ['Ø§', 'Ø¥', 'Ø¢'],
                'Ø¥': ['Ø§', 'Ø£', 'Ø¢'],
                'Ø¢': ['Ø§', 'Ø£', 'Ø¥'],
                'Ø©': ['Ù‡'],
                'Ù‡': ['Ø©'],
                'Ù‰': ['ÙŠ'],
                'ÙŠ': ['Ù‰']
            };
            
            const textChars = text.split('');
            const queryChars = query.split('');
            
            for (let i = 0; i <= textChars.length - queryChars.length; i++) {
                let match = true;
                for (let j = 0; j < queryChars.length; j++) {
                    const textChar = textChars[i + j];
                    const queryChar = queryChars[j];
                    
                    if (textChar !== queryChar) {
                        const possibleVariations = variations[queryChar] || [];
                        if (!possibleVariations.includes(textChar)) {
                            match = false;
                            break;
                        }
                    }
                }
                if (match) return true;
            }
            
            return false;
        }
        
        // Ø¹Ø±Ø¶ Ø³ÙˆØ±Ø© ÙƒØ§Ù…Ù„Ø©
        function displayCompleteSurah(surah) {
            if (!surah || !surah.ayas) {
                addMessageToUI('Ù„Ù… Ø£ØªÙ…ÙƒÙ† Ù…Ù† Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø§Ù„Ø³ÙˆØ±Ø© Ø§Ù„Ù…Ø·Ù„ÙˆØ¨Ø©.', 'assistant', null, [], true);
                return;
            }
            
            let surahContent = `<div class="complete-surah-container">
                <div class="surah-header">
                    <div class="surah-title">Ø³ÙˆØ±Ø© ${surah.name}</div>
                    <div class="surah-info">
                        <span>Ø±Ù‚Ù… Ø§Ù„Ø³ÙˆØ±Ø©: ${surah.id}</span>
                        <span>Ø¹Ø¯Ø¯ Ø§Ù„Ø¢ÙŠØ§Øª: ${surah.ayas.length}</span>
                        <span>Ù†ÙˆØ¹ Ø§Ù„Ø³ÙˆØ±Ø©: ${surah.revelationType === 'Meccan' ? 'Ù…ÙƒÙŠØ©' : 'Ù…Ø¯Ù†ÙŠØ©'}</span>
                    </div>
                </div>
                
                <div class="ayahs-container">`;
            
            surah.ayas.forEach((ayah, index) => {
                surahContent += `
                    <div class="ayah-item">
                        <div class="ayah-text">${ayah.text}</div>
                        <div class="ayah-number">Ø¢ÙŠØ© ${index + 1}</div>
                    </div>
                `;
            });
            
            surahContent += `</div>
                <div class="surah-footer">
                    <div class="single-ayah-verified">
                        âœ“ ØªÙ… Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…ØµØ¯Ø± Ø§Ù„Ù…Ø¹ØªÙ…Ø¯
                    </div>
                    <div style="margin-top: 1rem; font-size: 0.9rem; color: rgba(255, 255, 255, 0.7);">
                        Ø§Ù†ØªÙ‡Øª Ø³ÙˆØ±Ø© ${surah.name} - ï´¿ØµØ¯Ù‚ Ø§Ù„Ù„Ù‡ Ø§Ù„Ø¹Ø¸ÙŠÙ…ï´¾
                    </div>
                </div>
            </div>`;
            
            addMessageToUI(surahContent, 'assistant', null, [], true, false, true);
        }
        
        // Ø¯Ø§Ù„Ø© showCompleteSurah Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        function showCompleteSurah(surahNumber) {
            if (!quranData) {
                addMessageToUI('Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù‚Ø±Ø¢Ù† ØºÙŠØ± Ù…ØªÙˆÙØ±Ø© Ø­Ø§Ù„ÙŠØ§Ù‹. ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.', 'assistant', null, [], true);
                return;
            }
            
            const surah = quranData.find(s => s.id === surahNumber);
            if (surah) {
                displayCompleteSurah(surah);
            }
        }
        
        // Ø¥Ø¶Ø§ÙØ© Ø±Ø³Ø§Ù„Ø© Ø¥Ù„Ù‰ Ø§Ù„ÙˆØ§Ø¬Ù‡Ø©
        function addMessageToUI(content, role, source = null, similarQuestions = [], saveToChat = true, isSingleAyah = false, isCompleteSurah = false) {
            const chatArea = document.getElementById('chatArea');
            const div = document.createElement('div');
            div.className = `message ${role}-message`;
            
            const chatSection = document.querySelector('.chat-section');
            if (chatSection) {
                chatSection.classList.add('has-messages');
            }
            
            let formattedContent = content;
            
            if (!isSingleAyah && !isCompleteSurah) {
                formattedContent = formatArabicText(content, isSingleAyah);
            }
            
            let html = `<div class="message-content">${formattedContent}`;
            
            if (role === 'assistant' && !isCompleteSurah) {
                if (similarQuestions && similarQuestions.length > 0) {
                    html += `<div class="similar-questions">`;
                    similarQuestions.forEach(q => {
                        html += `<div class="q-chip" onclick="askQuestion('${escapeHtml(q)}')">${escapeHtml(q)}</div>`;
                    });
                    html += `</div>`;
                }
            }
            
            html += `</div>`;
            div.innerHTML = html;
            chatArea.appendChild(div);
            
            setTimeout(() => {
                chatArea.scrollTop = chatArea.scrollHeight;
            }, 100);

            if (saveToChat && currentChatId) {
                const chat = chats.find(c => c.id === currentChatId);
                if (chat) {
                    chat.messages.push({
                        role: role,
                        content: content,
                        source: source,
                        questions: similarQuestions,
                        isSingleAyah: isSingleAyah,
                        isCompleteSurah: isCompleteSurah
                    });
                    saveChatsToStorage();
                    updateChatTitle(chat);
                }
            }
        }
        
        // ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù†Øµ Ø§Ù„Ø¹Ø±Ø¨ÙŠ
        function formatArabicText(text, isSingleAyah = false) {
            if (!text) return '';
            
            text = text.replace(/Ø§Ù„Ù…ØµØ¯Ø±:.*?(?:\n|$)/g, '');
            text = text.replace(/Ø§Ù„Ø±Ø§ÙˆÙŠ:.*?(?:\n|$)/g, '');
            text = text.replace(/\*\*([^*]+)\*\*/g, '$1');
            text = text.replace(/\*([^*]+)\*/g, '$1');
            text = text.replace(/^[\s]*[â€¢\*\-â—‹â—â–ªï¸â–«ï¸â– â–¡â—†â—‡]+[\s]*/gm, '');
            text = text.replace(/\n[\s]*[â€¢\*\-â—‹â—â–ªï¸â–«ï¸â– â–¡â—†â—‡]+[\s]*/g, '\n');
            text = text.replace(/\[[\s]*\]/g, '');
            
            const arabicNumerals = ['Ù ', 'Ù¡', 'Ù¢', 'Ù£', 'Ù¤', 'Ù¥', 'Ù¦', 'Ù§', 'Ù¨', 'Ù©'];
            text = text.replace(/\d/g, (digit) => arabicNumerals[parseInt(digit)]);
            
            if (!isSingleAyah) {
                text = text.replace(/ï´¿([^ï´¾]+)ï´¾/g, '<span class="quran-verse">ï´¿$1ï´¾</span>');
                
                text = text.replace(/"([^"]+)"/g, function(match, verse) {
                    const quranIndicators = ['Ø§Ù„Ù„Ù‡', 'Ø±Ø¨', 'Ù‚Ù„', 'ÙŠØ§ Ø£ÙŠÙ‡Ø§', 'Ø¥Ù†', 'Ø§Ù„Ø°ÙŠÙ† Ø¢Ù…Ù†ÙˆØ§'];
                    const looksLikeQuran = quranIndicators.some(word => verse.includes(word)) && verse.length > 20;
                    
                    if (looksLikeQuran) {
                        return `<span class="quran-verse">"${verse}"</span>`;
                    }
                    return match;
                });
            }
            
            text = text.replace(/\s*ØŒ\s*/g, 'ØŒ ');
            text = text.replace(/\s*Ø›\s*/g, 'Ø› ');
            text = text.replace(/\n\n+/g, '<br><br>');
            text = text.replace(/\n/g, '<br>');
            text = text.replace(/\s{2,}/g, ' ');
            
            return text;
        }
        
        // Ø§Ù„Ù‡Ø±ÙˆØ¨ Ù…Ù† HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
        
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø£Ø³Ø¦Ù„Ø© Ù…Ø´Ø§Ø¨Ù‡Ø©
        function getSimilarQuestions(message) {
            const questions = [
                'Ù…Ø§ Ù‡ÙŠ Ø£Ø±ÙƒØ§Ù† Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ØŸ',
                'Ù…Ø§ Ø­ÙƒÙ… Ø§Ù„ØµÙ„Ø§Ø© ÙÙŠ Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ØŸ',
                'Ù…Ø§ Ù‡ÙŠ Ø´Ø±ÙˆØ· Ø§Ù„ÙˆØ¶ÙˆØ¡ØŸ',
                'Ù…Ø§ Ù‡ÙŠ Ø£Ø­ÙƒØ§Ù… Ø§Ù„ØµÙŠØ§Ù…ØŸ',
                'Ù…Ø§ Ù‡Ùˆ Ø­Ø¯ÙŠØ« Ø§Ù„Ø´ÙØ§Ø¹Ø©ØŸ'
            ];
            
            return questions.sort(() => Math.random() - 0.5).slice(0, 3);
        }
        
        // Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ù…ØµØ§Ø¯Ø± Ø­Ø³Ø¨ Ø§Ù„Ù…ÙˆØ¶ÙˆØ¹
        function getSourcesByTopic(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('ØµÙ„Ø§Ø©') || lowerMessage.includes('ØµÙ„Ø§Ø©')) {
                return ['ØµØ­ÙŠØ­ Ø§Ù„Ø¨Ø®Ø§Ø±ÙŠ', 'ØµØ­ÙŠØ­ Ù…Ø³Ù„Ù…', 'Ø³Ù†Ù† Ø£Ø¨ÙŠ Ø¯Ø§ÙˆØ¯'];
            } else if (lowerMessage.includes('Ø²ÙƒØ§Ø©') || lowerMessage.includes('Ø²ÙƒØ§Ø©')) {
                return ['ØµØ­ÙŠØ­ Ø§Ù„Ø¨Ø®Ø§Ø±ÙŠ', 'Ø³Ù†Ù† Ø§Ù„ØªØ±Ù…Ø°ÙŠ', 'Ù…ÙˆØ·Ø£ Ù…Ø§Ù„Ùƒ'];
            } else if (lowerMessage.includes('ØµÙˆÙ…') || lowerMessage.includes('ØµÙŠØ§Ù…')) {
                return ['ØµØ­ÙŠØ­ Ù…Ø³Ù„Ù…', 'Ø³Ù†Ù† Ø§Ù„Ù†Ø³Ø§Ø¦ÙŠ', 'Ø³Ù†Ù† Ø§Ø¨Ù† Ù…Ø§Ø¬Ø©'];
            } else if (lowerMessage.includes('Ø­Ø¬') || lowerMessage.includes('Ø­Ø¬')) {
                return ['ØµØ­ÙŠØ­ Ø§Ù„Ø¨Ø®Ø§Ø±ÙŠ', 'ØµØ­ÙŠØ­ Ù…Ø³Ù„Ù…', 'Ø³Ù†Ù† Ø£Ø¨ÙŠ Ø¯Ø§ÙˆØ¯'];
            }
            
            return ['ØµØ­ÙŠØ­ Ø§Ù„Ø¨Ø®Ø§Ø±ÙŠ', 'ØµØ­ÙŠØ­ Ù…Ø³Ù„Ù…', 'Ø³Ù†Ù† Ø§Ù„ØªØ±Ù…Ø°ÙŠ'];
        }
        
        // ØªÙˆÙ„ÙŠØ¯ Ø±Ø¯
        function generateResponse(message, sources) {
            const lowerMessage = message.toLowerCase();
            
            let response = '';
            
            if (lowerMessage.includes('Ø£Ø±ÙƒØ§Ù† Ø§Ù„Ø¥Ø³Ù„Ø§Ù…') || lowerMessage.includes('Ø§Ø±ÙƒØ§Ù† Ø§Ù„Ø§Ø³Ù„Ø§Ù…')) {
                response = `Ø£Ø±ÙƒØ§Ù† Ø§Ù„Ø¥Ø³Ù„Ø§Ù… Ø®Ù…Ø³Ø©:\n\n`;
                response += `1. Ø´Ù‡Ø§Ø¯Ø© Ø£Ù† Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡ ÙˆØ£Ù† Ù…Ø­Ù…Ø¯Ø§Ù‹ Ø±Ø³ÙˆÙ„ Ø§Ù„Ù„Ù‡\n`;
                response += `2. Ø¥Ù‚Ø§Ù… Ø§Ù„ØµÙ„Ø§Ø©\n`;
                response += `3. Ø¥ÙŠØªØ§Ø¡ Ø§Ù„Ø²ÙƒØ§Ø©\n`;
                response += `4. ØµÙˆÙ… Ø±Ù…Ø¶Ø§Ù†\n`;
                response += `5. Ø­Ø¬ Ø§Ù„Ø¨ÙŠØª Ù„Ù…Ù† Ø§Ø³ØªØ·Ø§Ø¹ Ø¥Ù„ÙŠÙ‡ Ø³Ø¨ÙŠÙ„Ø§Ù‹\n\n`;
                response += `ğŸ“š Ø§Ù„Ù…ØµØ§Ø¯Ø±: ${sources.join('ØŒ ')}`;
            }
            else if (lowerMessage.includes('Ø­ÙƒÙ… Ø§Ù„ØµÙ„Ø§Ø©') || lowerMessage.includes('Ø­ÙƒÙ… Ø§Ù„ØµÙ„Ø§Ø©')) {
                response = `Ø§Ù„ØµÙ„Ø§Ø© Ù‡ÙŠ Ø§Ù„Ø±ÙƒÙ† Ø§Ù„Ø«Ø§Ù†ÙŠ Ù…Ù† Ø£Ø±ÙƒØ§Ù† Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ØŒ ÙˆÙ‡ÙŠ ÙØ±Ø¶ Ø¹ÙŠÙ† Ø¹Ù„Ù‰ ÙƒÙ„ Ù…Ø³Ù„Ù… Ø¨Ø§Ù„Øº Ø¹Ø§Ù‚Ù„.\n\n`;
                response += `Ù‚Ø§Ù„ ØªØ¹Ø§Ù„Ù‰: "ÙˆÙØ£ÙÙ‚ÙÙŠÙ…ÙÙˆØ§ Ø§Ù„ØµÙ‘ÙÙ„ÙØ§Ø©Ù ÙˆÙØ¢ØªÙÙˆØ§ Ø§Ù„Ø²Ù‘ÙÙƒÙØ§Ø©Ù ÙˆÙØ§Ø±Ù’ÙƒÙØ¹ÙÙˆØ§ Ù…ÙØ¹Ù Ø§Ù„Ø±Ù‘ÙØ§ÙƒÙØ¹ÙÙŠÙ†Ù" (Ø§Ù„Ø¨Ù‚Ø±Ø©: 43)\n\n`;
                response += `ÙˆÙ‚Ø§Ù„ Ø±Ø³ÙˆÙ„ Ø§Ù„Ù„Ù‡ ØµÙ„Ù‰ Ø§Ù„Ù„Ù‡ Ø¹Ù„ÙŠÙ‡ ÙˆØ³Ù„Ù…: "Ø¨Ù†ÙŠ Ø§Ù„Ø¥Ø³Ù„Ø§Ù… Ø¹Ù„Ù‰ Ø®Ù…Ø³: Ø´Ù‡Ø§Ø¯Ø© Ø£Ù† Ù„Ø§ Ø¥Ù„Ù‡ Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡ ÙˆØ£Ù† Ù…Ø­Ù…Ø¯Ø§Ù‹ Ø±Ø³ÙˆÙ„ Ø§Ù„Ù„Ù‡ØŒ ÙˆØ¥Ù‚Ø§Ù… Ø§Ù„ØµÙ„Ø§Ø©..." (Ø±ÙˆØ§Ù‡ Ø§Ù„Ø¨Ø®Ø§Ø±ÙŠ ÙˆÙ…Ø³Ù„Ù…)\n\n`;
                response += `ğŸ“š Ø§Ù„Ù…ØµØ§Ø¯Ø±: ${sources.join('ØŒ ')}`;
            }
            else if (lowerMessage.includes('Ø´Ø±ÙˆØ· Ø§Ù„ÙˆØ¶ÙˆØ¡') || lowerMessage.includes('Ø´Ø±ÙˆØ· Ø§Ù„ÙˆØ¶ÙˆØ¡')) {
                response = `Ø´Ø±ÙˆØ· Ø§Ù„ÙˆØ¶ÙˆØ¡:\n\n`;
                response += `1. Ø§Ù„Ø¥Ø³Ù„Ø§Ù…\n`;
                response += `2. Ø§Ù„Ø¹Ù‚Ù„\n`;
                response += `3. Ø§Ù„ØªÙ…ÙŠØ²\n`;
                response += `4. Ø§Ù„Ù†ÙŠØ©\n`;
                response += `5. Ø·Ù‡ÙˆØ±ÙŠØ© Ø§Ù„Ù…Ø§Ø¡\n`;
                response += `6. Ø¥Ø²Ø§Ù„Ø© Ù…Ø§ ÙŠÙ…Ù†Ø¹ ÙˆØµÙˆÙ„ Ø§Ù„Ù…Ø§Ø¡ Ø¥Ù„Ù‰ Ø§Ù„Ø¨Ø´Ø±Ø©\n`;
                response += `7. Ø¯Ø®ÙˆÙ„ ÙˆÙ‚Øª Ø§Ù„ØµÙ„Ø§Ø© Ù„Ù„Ø­Ø¯Ø« Ø§Ù„Ø¯Ø§Ø¦Ù…\n\n`;
                response += `ğŸ“š Ø§Ù„Ù…ØµØ§Ø¯Ø±: ${sources.join('ØŒ ')}`;
            }
            else if (lowerMessage.includes('Ø£Ø­ÙƒØ§Ù… Ø§Ù„ØµÙŠØ§Ù…') || lowerMessage.includes('Ø§Ø­ÙƒØ§Ù… Ø§Ù„ØµÙŠØ§Ù…')) {
                response = `Ù…Ù† Ø£Ø­ÙƒØ§Ù… Ø§Ù„ØµÙŠØ§Ù…:\n\n`;
                response += `1. Ø§Ù„ØµÙŠØ§Ù… ÙØ±Ø¶ ÙÙŠ Ø±Ù…Ø¶Ø§Ù† Ø¹Ù„Ù‰ ÙƒÙ„ Ù…Ø³Ù„Ù… Ø¨Ø§Ù„Øº Ø¹Ø§Ù‚Ù„ Ù‚Ø§Ø¯Ø±\n`;
                response += `2. ÙŠØ¬Ø¨ Ø¹Ù„Ù‰ Ø§Ù„ØµØ§Ø¦Ù… Ø§Ù„Ø¥Ù…Ø³Ø§Ùƒ Ø¹Ù† Ø§Ù„Ù…ÙØ·Ø±Ø§Øª Ù…Ù† Ø·Ù„ÙˆØ¹ Ø§Ù„ÙØ¬Ø± Ø¥Ù„Ù‰ ØºØ±ÙˆØ¨ Ø§Ù„Ø´Ù…Ø³\n`;
                response += `3. Ù…Ù† Ø£ÙØ·Ø± ÙÙŠ Ø±Ù…Ø¶Ø§Ù† Ø¨Ø¯ÙˆÙ† Ø¹Ø°Ø± ÙØ¹Ù„ÙŠÙ‡ Ø§Ù„Ù‚Ø¶Ø§Ø¡ ÙˆØ§Ù„ÙƒÙØ§Ø±Ø©\n`;
                response += `4. Ø§Ù„Ù…Ø³ØªØ­Ø¨Ø§Øª: ØªØ¹Ø¬ÙŠÙ„ Ø§Ù„ÙØ·ÙˆØ±ØŒ ÙˆØªØ£Ø®ÙŠØ± Ø§Ù„Ø³Ø­ÙˆØ±ØŒ ÙˆØ§Ù„Ø¥ÙƒØ«Ø§Ø± Ù…Ù† Ø§Ù„Ø·Ø§Ø¹Ø§Øª\n`;
                response += `5. Ø§Ù„Ù…ÙƒØ±ÙˆÙ‡Ø§Øª: Ø§Ù„Ù…Ø¨Ø§Ù„ØºØ© ÙÙŠ Ø§Ù„Ù…Ø¶Ù…Ø¶Ø© ÙˆØ§Ù„Ø§Ø³ØªÙ†Ø´Ø§Ù‚ØŒ Ø°ÙˆÙ‚ Ø§Ù„Ø·Ø¹Ø§Ù… Ø¨Ø¯ÙˆÙ† Ø­Ø§Ø¬Ø©\n\n`;
                response += `ğŸ“š Ø§Ù„Ù…ØµØ§Ø¯Ø±: ${sources.join('ØŒ ')}`;
            }
            else {
                response = `Ø£Ù‡Ù„Ø§Ù‹ ÙˆØ³Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ. ÙŠÙ…ÙƒÙ†Ù†ÙŠ Ù…Ø³Ø§Ø¹Ø¯ØªÙƒ ÙÙŠ:\n\n`;
                response += `â€¢ ØªÙØ³ÙŠØ± Ø§Ù„Ø¢ÙŠØ§Øª Ø§Ù„Ù‚Ø±Ø¢Ù†ÙŠØ©\n`;
                response += `â€¢ Ø´Ø±Ø­ Ø§Ù„Ø£Ø­Ø§Ø¯ÙŠØ« Ø§Ù„Ù†Ø¨ÙˆÙŠØ©\n`;
                response += `â€¢ Ø§Ù„ÙÙ‚Ù‡ ÙˆØ£Ø­ÙƒØ§Ù… Ø§Ù„Ø´Ø±ÙŠØ¹Ø© Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©\n`;
                response += `â€¢ Ø§Ù„Ø£Ø®Ù„Ø§Ù‚ ÙˆØ§Ù„Ø¢Ø¯Ø§Ø¨ Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠØ©\n`;
                response += `â€¢ Ø§Ù„Ø³ÙŠØ±Ø© Ø§Ù„Ù†Ø¨ÙˆÙŠØ© ÙˆØ§Ù„ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠ\n\n`;
                response += `ÙŠØ±Ø¬Ù‰ ØªØ­Ø¯ÙŠØ¯ Ø³Ø¤Ø§Ù„Ùƒ Ø¨Ø´ÙƒÙ„ Ø£ÙƒØ«Ø± Ø¯Ù‚Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø¬Ø§Ø¨Ø© Ù…ÙØµÙ„Ø©.\n\n`;
                response += `ğŸ“š Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ù…Ø¹ØªÙ…Ø¯Ø©: ØµØ­ÙŠØ­ Ø§Ù„Ø¨Ø®Ø§Ø±ÙŠØŒ ØµØ­ÙŠØ­ Ù…Ø³Ù„Ù…ØŒ Ø§Ù„Ù‚Ø±Ø¢Ù† Ø§Ù„ÙƒØ±ÙŠÙ…`;
            }
            
            return response;
        }
        
        // Ø·Ø±Ø­ Ø³Ø¤Ø§Ù„ Ù…Ø¹ÙŠÙ†
        function askQuestion(question) {
            const userInput = document.getElementById('userInput');
            userInput.value = question;
            autoResize(userInput);
            sendMessage();
        }
    </script>
</body>
</html>
