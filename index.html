<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AskIslamAI - Ø§Ù„Ù…Ø³Ø§Ø¹Ø¯ Ø§Ù„Ø¥Ø³Ù„Ø§Ù…ÙŠ Ø§Ù„Ø°ÙƒÙŠ</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Katibeh&family=Tajawal:wght@300;400;500;700&family=Amiri:wght@400;700&display=swap" rel="stylesheet">
    <style>
        /* ... (Ø¬Ù…ÙŠØ¹ Ø§Ù„ØªÙ†Ø³ÙŠÙ‚Ø§Øª CSS Ø§Ù„ØªÙŠ ÙƒØ§Ù†Øª ÙÙŠ ÙƒÙˆØ¯Ùƒ Ø§Ù„Ø£ØµÙ„ÙŠ ØªØ¨Ù‚Ù‰ ÙƒÙ…Ø§ Ù‡ÙŠ) ... */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        :root { --primary-green: #0d7377; --secondary-green: #14a085; --gold: #d4af37; --light-bg: #f8f9fa; --dark-text: #2c3e50; --border-color: #e0e0e0; --hover-bg: #f0fffe; }
        body { font-family: 'Tajawal', sans-serif; background: #ffffff; min-height: 100vh; direction: rtl; }
        .katibeh { font-family: "Katibeh", serif; font-weight: 400; }
        .sidebar { position: fixed; right: 0; top: 0; width: 280px; height: 100vh; background: #f8f9fa; border-left: 1px solid var(--border-color); display: flex; flex-direction: column; z-index: 100; transition: transform 0.3s ease; }
        .sidebar.hidden { transform: translateX(280px); }
        .sidebar-header { padding: 1.5rem; border-bottom: 1px solid var(--border-color); }
        .new-chat-btn { width: 100%; padding: 1rem; background: linear-gradient(135deg, var(--primary-green), var(--secondary-green)); color: white; border: none; border-radius: 10px; cursor: pointer; font-family: 'Tajawal', sans-serif; font-weight: 600; display: flex; align-items: center; justify-content: center; gap: 0.5rem; }
        .chat-history { flex: 1; overflow-y: auto; padding: 1rem; }
        .chat-history-item { padding: 0.8rem 1rem; margin-bottom: 0.5rem; border-radius: 8px; cursor: pointer; background: white; border: 1px solid transparent; }
        .chat-history-item.active { background: var(--hover-bg); border-color: var(--secondary-green); }
        .main-content { margin-right: 280px; height: 100vh; display: flex; flex-direction: column; }
        .header { padding: 1rem 2rem; border-bottom: 1px solid var(--border-color); background: white; display: flex; align-items: center; justify-content: space-between; position: sticky; top: 0; z-index: 50; }
        .logo-text { font-size: 1.5rem; background: linear-gradient(135deg, var(--primary-green), var(--secondary-green)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .chat-area { flex: 1; overflow-y: auto; padding: 2rem; background: white; }
        .message { margin-bottom: 2rem; animation: fadeIn 0.4s ease-in; }
        .message-header { display: flex; align-items: center; gap: 0.8rem; margin-bottom: 0.8rem; }
        .message-avatar { width: 36px; height: 36px; border-radius: 50%; display: flex; align-items: center; justify-content: center; color: white; }
        .user-message .message-avatar { background: var(--gold); }
        .ai-message .message-avatar { background: var(--primary-green); }
        .message-content { padding-right: 44px; line-height: 1.8; }
        .input-area { padding: 1.5rem; border-top: 1px solid var(--border-color); }
        .input-wrapper { display: flex; gap: 1rem; border: 2px solid var(--border-color); border-radius: 16px; padding: 1rem; }
        textarea { flex: 1; border: none; outline: none; resize: none; font-family: inherit; }
        .send-btn { background: var(--primary-green); color: white; border: none; border-radius: 8px; width: 40px; cursor: pointer; }
        .typing-indicator { display: none; padding-right: 44px; margin-bottom: 1rem; }
        .typing-indicator.active { display: block; }
        @media (max-width: 768px) { .sidebar { transform: translateX(280px); } .main-content { margin-right: 0; } }
    </style>
</head>
<body>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <button class="new-chat-btn" onclick="startNewChat()">â• Ù…Ø­Ø§Ø¯Ø«Ø© Ø¬Ø¯ÙŠØ¯Ø©</button>
        </div>
        <div class="chat-history" id="chatHistory"></div>
    </aside>

    <main class="main-content">
        <header class="header">
            <button onclick="toggleSidebar()">â˜°</button>
            <h1 class="logo-text katibeh">AskIslamAI</h1>
            <div></div>
        </header>

        <div class="chat-area" id="chatArea">
            <div id="welcomeScreen" class="welcome-screen" style="text-align: center; padding: 3rem;">
                <h2 class="katibeh" style="font-size: 2.5rem; color: var(--primary-green);">Ø¨ÙØ³Ù’Ù…Ù Ù±Ù„Ù„ÙÙ‘Ù°Ù‡Ù Ù±Ù„Ø±ÙÙ‘Ø­Ù’Ù…ÙÙ°Ù†Ù Ù±Ù„Ø±ÙÙ‘Ø­ÙÙŠÙ…Ù</h2>
                <p>Ø§Ø³Ø£Ù„ Ø¹Ù† Ø£ÙŠ Ù…ÙˆØ¶ÙˆØ¹ Ø¥Ø³Ù„Ø§Ù…ÙŠ ÙˆØ³Ø£Ø¬ÙŠØ¨Ùƒ Ù…Ù† Ø§Ù„Ù…ØµØ§Ø¯Ø± Ø§Ù„Ù…ÙˆØ«ÙˆÙ‚Ø©.</p>
            </div>
            <div id="messagesContainer"></div>
            <div class="typing-indicator" id="typingIndicator">Ø¬Ø§Ø±ÙŠ Ø§Ù„ÙƒØªØ§Ø¨Ø©...</div>
        </div>

        <div class="input-area">
            <div class="input-wrapper">
                <textarea id="userInput" placeholder="Ø§ÙƒØªØ¨ Ø³Ø¤Ø§Ù„Ùƒ Ù‡Ù†Ø§..." rows="1" oninput="this.style.height='auto';this.style.height=this.scrollHeight+'px'"></textarea>
                <button class="send-btn" id="sendBtn" onclick="sendMessage()">â¬†ï¸</button>
            </div>
        </div>
    </main>

    <script>
        let messageHistory = [];
        let currentChatId = Date.now().toString();

        function toggleSidebar() {
            document.getElementById('sidebar').classList.toggle('hidden');
        }

        function startNewChat() {
            messageHistory = [];
            document.getElementById('messagesContainer').innerHTML = '';
            document.getElementById('welcomeScreen').style.display = 'block';
            currentChatId = Date.now().toString();
        }

        function addMessageToUI(content, role) {
            const container = document.getElementById('messagesContainer');
            const msgDiv = document.createElement('div');
            msgDiv.className = `message ${role === 'user' ? 'user-message' : 'ai-message'}`;
            
            msgDiv.innerHTML = `
                <div class="message-header">
                    <div class="message-avatar">${role === 'user' ? 'ğŸ‘¤' : 'â˜ªï¸'}</div>
                    <span class="message-name">${role === 'user' ? 'Ø£Ù†Øª' : 'AskIslamAI'}</span>
                </div>
                <div class="message-content">${content.replace(/\n/g, '<br>')}</div>
            `;
            
            container.appendChild(msgDiv);
            document.getElementById('chatArea').scrollTop = document.getElementById('chatArea').scrollHeight;
        }

        async function sendMessage() {
            const input = document.getElementById('userInput');
            const text = input.value.trim();
            if (!text) return;

            document.getElementById('welcomeScreen').style.display = 'none';
            addMessageToUI(text, 'user');
            messageHistory.push({ role: 'user', content: text });
            
            input.value = '';
            document.getElementById('typingIndicator').classList.add('active');

            try {
                // Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ù€ Worker Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
                const response = await fetch('/api/chat', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        model: 'claude-3-5-sonnet-20240620', // Ø§Ø³ØªØ®Ø¯Ù…ÙŠ Ø§Ù„Ù…ÙˆØ¯ÙŠÙ„ Ø§Ù„Ù…ØªØ§Ø­ ÙÙŠ Ø­Ø³Ø§Ø¨Ùƒ
                        max_tokens: 2048,
                        system: "Ø£Ù†Øª Ù…Ø³Ø§Ø¹Ø¯ Ø¥Ø³Ù„Ø§Ù…ÙŠ Ù…ØªØ®ØµØµ. Ø£Ø¬Ø¨ ÙÙ‚Ø· Ù…Ù† Ø§Ù„Ù‚Ø±Ø¢Ù† ÙˆØ§Ù„Ø³Ù†Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ø¨Ø§Ù„Ù„ØºØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„ÙØµØ­Ù‰.",
                        messages: messageHistory
                    })
                });

                const data = await response.json();
                document.getElementById('typingIndicator').classList.remove('active');

                if (data.content && data.content[0]) {
                    const aiText = data.content[0].text;
                    addMessageToUI(aiText, 'assistant');
                    messageHistory.push({ role: 'assistant', content: aiText });
                }
            } catch (error) {
                document.getElementById('typingIndicator').classList.remove('active');
                addMessageToUI("Ø¹Ø°Ø±Ø§Ù‹ØŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„. ØªØ£ÙƒØ¯ÙŠ Ù…Ù† Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù€ Worker.", "assistant");
                console.error(error);
            }
        }
    </script>
</body>
</html>
