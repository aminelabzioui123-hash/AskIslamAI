import os
import gradio as gr
import google.generativeai as genai

# ===============================
# ุฅุนุฏุงุฏ ููุชุงุญ Gemini ูู Render
# ===============================
API_KEY = os.getenv("GOOGLE_API_KEY")
if not API_KEY:
    raise RuntimeError("GOOGLE_API_KEY ุบูุฑ ููุฌูุฏ ูู Environment Variables")

genai.configure(api_key=API_KEY)

# ===============================
# ุฏุงูุฉ ุงูุฅุฌุงุจุฉ ุงูุดุฑุนูุฉ
# ===============================
def ask_islam(message, history):
    model = genai.GenerativeModel("gemini-1.5-flash")
    
    strict_prompt = f"""
ุฃูุช ุจุงุญุซ ุฅุณูุงูู ุณูููู ููุชุฒู ุจูููุฌ ุฃูู ุงูุณูุฉ ูุงูุฌูุงุนุฉ.
ุงูุชุฒู ุจุงูููุงุนุฏ ุงูุชุงููุฉ ุญุฑููุงู:
1- ูุง ุชุฌุจ ุฅูุง ุจุฏููู ูู:
   - ุงููุฑุขู ุงููุฑูู
   - ุงูุณูุฉ ุงูุตุญูุญุฉ
   - ุฃููุงู ุฃุฆูุฉ ุฃูู ุงูุณูุฉ ุงููุนุชูุฏูู
     (ูุซู: ุงูุจุฎุงุฑูุ ูุณููุ ุงูููููุ ุงุจู ุชูููุฉุ ุงุจู ุงููููุ ุงูุทุจุฑู).
2- ุงุฐูุฑ ุงูุฏููู ุฃู ุงููุฑุฌุน ุจุงุฎุชุตุงุฑ.
3- ุฅู ูู ููุฌุฏ ุฏููู ุตุฑูุญุ ููู ููุท: "ูุง ุฃุนูู".
4- ูููุน ุงูุฑุฃู ุงูุดุฎุตู ุฃู ุงูููุงู ุงููุนุงุตุฑ ุจูุง ุฃุตู.
5- ูุง ุชูุตุฏุฑ ูุชููุ ุจู ุจูุงู ุนููู ููุท.

ุงูุณุคุงู:
{message}
"""
    
    try:
        response = model.generate_content(strict_prompt)
        return response.text
    except Exception as e:
        print(f"ุฎุทุฃ: {e}")  # ููุชุณุฌูู ูู logs
        return "ุญุฏุซ ุฎุทุฃ ุชููู. ูุฑุฌู ุงููุญุงููุฉ ูุงุญูุงู."

# ===============================
# ูุงุฌูุฉ Gradio
# ===============================
demo = gr.ChatInterface(
    fn=ask_islam,
    title="๐ AskIslamAI",
    description=(
        "ุงูุฅุฌุงุจุงุช ุชุนุชูุฏ ุนูู ุงููุฑุขู ูุงูุณูุฉ ูููู ุฃุฆูุฉ ุฃูู ุงูุณูุฉ.\n"
        "โ๏ธ ููุงุณุชุฆูุงุณ ุงูุนููู ููุท ูููุณุช ุจุฏููุงู ุนู ุงูุนููุงุก."
    ),
    examples=[
        "ูุง ุญูู ุตูุงุฉ ุงูุฌูุงุนุฉุ",
        "ููู ุฃุชูุถุฃ ุจุดูู ุตุญูุญุ"
    ]
)

# ===============================
# ุชุดุบูู ุงูุชุทุจูู (Render-safe)
# ===============================
if __name__ == "__main__":
    demo.launch(
        server_name="0.0.0.0",
        server_port=int(os.environ.get("PORT", 7860)),
        share=False
    )
